(function(d){var b=new Bloodhound({datumTokenizer:function(g){return Bloodhound.tokenizers.whitespace(g.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var f=new Bloodhound({datumTokenizer:function(g){return Bloodhound.tokenizers.whitespace(g.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(h,i){var j=h+i;var g=d(".sg-node-search").filter(":focus");var l=d("#"+g.attr("data-select-id")+" option").filter(":selected");var k=l.attr(g.attr("data-attr"));if(k!=null&&k.length>0){j+="&tags="+encodeURIComponent(k)}return j}}});d.fn.onEnter=function(g){this.bind("keypress",function(h){if(h.keyCode==13){g.apply(this,[h])}});return this};var a=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function c(l,k,j,g,i){var h=urlSegradaPictogramSearch+encodeURIComponent(i);d.getJSON(h,function(n){var m=[];d.each(n,function(o,p){var q=d("<div/>").text(p.title).html();m.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+p.id+'" data-uid="'+p.uid+'" title="'+q+'"><img src="'+urlSegradaPictogramFile+p.uid+'" width="24" height="24" alt="'+q+'" /></a></div>')});k.html("<div class='row'>"+m.join("")+"</div>");d("a",k).click(function(r){var q=d(this).attr("data-id");var p=d(this).attr("data-uid");var o=d("<div/>").text(d(this).attr("title")).html();d("#value-"+j,g).val(q);d("#preview-"+j,g).html('<img src="'+urlSegradaPictogramFile+p+'" width="24" height="24" alt="'+o+'" /> '+o);d("#clear-"+j,g).show();r.preventDefault();l.modal("hide")})})}function e(g){g=g||d("body");d(".sg-data").addClass("sg-dynamic-data");d(".sg-headbox-right").show();d(".sg-dynamic-hide").hide();d(".sg-data-add",g).click(function(h){d.get(d(this).attr("href"),function(l){var k=l.match(a);if(k!=null&&k.length>=2){d("#"+k[2]).remove()}var j=d("#sg-data");j.prepend(l);var i=j.children(":first");e(i)});h.preventDefault()});d(".sg-control-form",g).ajaxForm({success:function(j,l,m,i){var k=i.attr("data-target-id");if(typeof k=="undefined"||k==null||k.length==0){k="#sg-control"}var h=d(k);h.html(j);e(h)}});d(".sg-control-set",g).click(function(k){var j=d(this);var i=j.attr("data-target-id");if(typeof i=="undefined"||i==null||i.length==0){i="#sg-control"}var h=d(i);h.wrapInner("<div class='sg-disabled'></div>");h.prepend(d("#sg-wait").html());d.get(j.attr("href"),function(l){h.html(l);e(h)});k.preventDefault()});d("[data-data-dblclick]",g).dblclick(function(){d.get(d(this).attr("data-data-dblclick"),function(k){var j=k.match(a);if(j!=null&&j.length>=2){d("#"+j[2]).remove()}var i=d("#sg-data");i.prepend(k);var h=i.children(":first");e(h)})});d("[data-confirm]",g).click(function(h){if(confirm(d(this).attr("data-confirm"))){if(d(this).hasClass("sg-control-confirm")){d.get(d(this).attr("href"),function(j){var i=d("#sg-control");i.html(j);e(i)})}}h.preventDefault()});d(".sg-replace-content",g).on("shown.bs.tab",function(j){var i=d(d(this).attr("href"));var h=d(this).attr("data-url");d.get(h,function(k){i.html(k);e(i)});d(this).removeClass("sg-replace-content");d(this).unbind("shown.bs.tab")});d(".sg-data-close",g).click(function(h){d(this).parent().parent().fadeOut("fast",function(){d(this).remove()})});d("input.sg-fileupload",g).fileinput({showUpload:false});d("input.sg-fileupload-small",g).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});d(".sg-pictogram-modal").on("shown.bs.modal",function(){var k=d(this);var j=k.attr("id");var i=d("#container-"+j,k);var h=d("#filter-"+j,k);h.on("input propertychange paste",function(){c(k,i,j,g,d(this).val())}).onEnter(function(){var m=d(".sg-pictogram-modal-link",i).first();if(m.length>0){var o=m.attr("data-id");var n=m.attr("data-id");var l=d("<div/>").text(m.attr("title")).html();d("#value-"+j,g).val(o);d("#preview-"+j,g).html('<img src="'+urlSegradaPictogramFile+n+'" width="24" height="24" alt="'+l+'" /> '+l);d("#clear-"+j,g).show();k.modal("hide")}});if(h.val()===""){c(k,i,j,g,"")}});d(".sg-pictogram-chooser",g).click(function(h){d("#"+d(this).attr("data-id")).modal("show");h.preventDefault()});d(".sg-pictogram-clearer",g).click(function(i){var h=d(this).attr("data-id");d("#value-"+h,g).val("");d("#preview-"+h,g).html("");d(this).hide();i.preventDefault()});d("select.sg-colorpicker",g).simplepicker({theme:"fontawesome"});d("select.sg-tags",g).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:b.ttAdapter()}});d("input.sg-node-search",g).each(function(){var i=d(this);var h=d("#"+i.attr("data-id"));i.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:f.ttAdapter()}).bind("typeahead:selected",function(k,j){h.val(j.id)}).bind("keyup",function(){if(!this.value){h.val("")}})});d("form.sg-data-form",g).ajaxForm({beforeSubmit:function(h,i,j){d(":input",i).attr("disabled",true);return true},success:function(j,l,m,h){var k=h.attr("data-id");if(typeof k!=="undefined"){k=d("#"+k)}k=k||h;k.replaceWith(j);var i=j.match(a);if(i!=null&&i.length>=2){e(d("#"+i[2]))}}})}d(document).ready(function(){d("#sg-close-all").click(function(g){d(".sg-data").fadeOut("fast",function(){d(this).remove()});g.preventDefault()});b.initialize();e(d("body"))})})(jQuery);