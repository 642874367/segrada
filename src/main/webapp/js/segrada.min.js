(function(e){var c=new Bloodhound({datumTokenizer:function(i){return Bloodhound.tokenizers.whitespace(i.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var h=new Bloodhound({datumTokenizer:function(i){return Bloodhound.tokenizers.whitespace(i.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(j,k){var l=j+k;var i=e(".sg-node-search").filter(":focus");var n=e("#"+i.attr("data-select-id")+" option").filter(":selected");var m=n.attr(i.attr("data-attr"));if(m!=null&&m.length>0){l+="&tags="+encodeURIComponent(m)}return l}}});var b=new Bloodhound({datumTokenizer:function(i){return Bloodhound.tokenizers.whitespace(i.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});e.fn.onEnter=function(i){this.bind("keypress",function(j){if(j.keyCode==13){i.apply(this,[j])}});return this};var a=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function d(n,m,l,i,k){var j=urlSegradaPictogramSearch+encodeURIComponent(k);e.getJSON(j,function(p){var o=[];e.each(p,function(q,r){var s=e("<div/>").text(r.title).html();o.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+r.id+'" data-uid="'+r.uid+'" title="'+s+'"><img src="'+urlSegradaPictogramFile+r.uid+'" width="24" height="24" alt="'+s+'" /></a></div>')});m.html("<div class='row'>"+o.join("")+"</div>");e("a",m).click(function(t){var s=e(this).attr("data-id");var r=e(this).attr("data-uid");var q=e("<div/>").text(e(this).attr("title")).html();e("#value-"+l,i).val(s);e("#preview-"+l,i).html('<img src="'+urlSegradaPictogramFile+r+'" width="24" height="24" alt="'+q+'" /> '+q);e("#clear-"+l,i).show();t.preventDefault();n.modal("hide")})})}function f(i){i=i||e("body");e(".sg-data").addClass("sg-dynamic-data");e(".sg-headbox-right").show();e(".sg-dynamic-hide").hide();e(".sg-data-add",i).click(function(j){e.get(e(this).attr("href"),function(n){var m=n.match(a);if(m!=null&&m.length>=2){e("#"+m[2]).remove()}var l=e("#sg-data");l.prepend(n);var k=l.children(":first");f(k)});j.preventDefault()});e(".sg-control-form",i).ajaxForm({beforeSubmit:function(j,l,m){var n=l.attr("data-target-id");if(typeof n=="undefined"||n==null||n.length==0){n="#sg-control"}var k=e(n);k.wrapInner("<div class='sg-disabled'></div>");k.prepend(e("#sg-wait").html());return true},success:function(l,n,o,k){var m=k.attr("data-target-id");if(typeof m=="undefined"||m==null||m.length==0){m="#sg-control"}var j=e(m);j.html(l);f(j)}});e(".sg-control-set",i).click(function(m){var l=e(this);var k=l.attr("data-target-id");if(typeof k=="undefined"||k==null||k.length==0){k="#sg-control"}var j=e(k);j.wrapInner("<div class='sg-disabled'></div>");j.prepend(e("#sg-wait").html());e.get(l.attr("href"),function(n){j.html(n);f(j)});m.preventDefault()});e("[data-data-dblclick]",i).dblclick(function(){e.get(e(this).attr("data-data-dblclick"),function(m){var l=m.match(a);if(l!=null&&l.length>=2){e("#"+l[2]).remove()}var k=e("#sg-data");k.prepend(m);var j=k.children(":first");f(j)})});e("tr [data-confirm]",i).click(function(k){var j=e(this);if(confirm(j.attr("data-confirm"))){var l=j.closest("tr");l.addClass("sg-disabled");e.get(j.attr("href"),function(m){l.slideUp("fast",function(){l.remove()})})}k.preventDefault()});e(".sg-replace-content",i).on("shown.bs.tab",function(l){var k=e(e(this).attr("href"));var j=e(this).attr("data-url");e.get(j,function(m){k.html(m);f(k)});e(this).removeClass("sg-replace-content");e(this).unbind("shown.bs.tab")});e(".sg-data-close",i).click(function(j){e(this).parent().parent().fadeOut("fast",function(){e(this).remove()})});e("input.sg-fileupload",i).fileinput({showUpload:false});e("input.sg-fileupload-small",i).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});e(".sg-pictogram-modal").on("shown.bs.modal",function(){var m=e(this);var l=m.attr("id");var k=e("#container-"+l,m);var j=e("#filter-"+l,m);j.on("input propertychange paste",function(){d(m,k,l,i,e(this).val())}).onEnter(function(){var o=e(".sg-pictogram-modal-link",k).first();if(o.length>0){var q=o.attr("data-id");var p=o.attr("data-id");var n=e("<div/>").text(o.attr("title")).html();e("#value-"+l,i).val(q);e("#preview-"+l,i).html('<img src="'+urlSegradaPictogramFile+p+'" width="24" height="24" alt="'+n+'" /> '+n);e("#clear-"+l,i).show();m.modal("hide")}});if(j.val()===""){d(m,k,l,i,"")}});e(".sg-pictogram-chooser",i).click(function(j){e("#"+e(this).attr("data-id")).modal("show");j.preventDefault()});e(".sg-pictogram-clearer",i).click(function(k){var j=e(this).attr("data-id");e("#value-"+j,i).val("");e("#preview-"+j,i).html("");e(this).hide();k.preventDefault()});e(".sg-taglist-contract",i).each(function(){var j=e("span",e(this));if(j.length>1){j.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');e("span.sg-tag-show",e(this)).click(function(){e(this).remove();j.show()})}});e("select.sg-colorpicker",i).simplepicker({theme:"fontawesome"});e("select.sg-tags",i).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:c.ttAdapter()}});e("input.sg-node-search",i).each(function(){var k=e(this);var j=e("#"+k.attr("data-id"));k.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:h.ttAdapter()}).bind("typeahead:selected",function(m,l){j.val(l.id)}).bind("keyup",function(){if(!this.value){j.val("")}})});e("input.sg-file-search",i).each(function(){var k=e(this);var j=e("#"+k.attr("data-id"));k.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:b.ttAdapter()}).bind("typeahead:selected",function(m,l){j.val(l.id)}).bind("keyup",function(){if(!this.value){j.val("")}})});e("form.sg-data-form",i).ajaxForm({beforeSubmit:function(j,k,l){e(":input",k).attr("disabled",true);return true},success:function(l,n,o,j){var m=j.attr("data-id");if(typeof m!=="undefined"){m=e("#"+m)}m=m||j;m.replaceWith(l);var k=l.match(a);if(k!=null&&k.length>=2){f(e("#"+k[2]))}}});e(".sg-geotab",i).on("shown.bs.tab",function(n){var m=e(n.target);var o=m.attr("data-map-id");var l=new ol.Map({target:o,layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"})})],view:new ol.View({center:ol.proj.fromLonLat([0,0]),zoom:1,maxZoom:10}),controls:ol.control.defaults({attributionOptions:{collapsible:false}})});var k=new ol.source.Vector({features:[]});var j=new ol.layer.Vector({source:k});l.addLayer(j);e("#"+o+"-content div").each(function(){var q=parseFloat(e(this).attr("data-lng"));var r=parseFloat(e(this).attr("data-lat"));var p=g(ol.proj.transform([q,r],"EPSG:4326","EPSG:3857"),mapIconStyle);k.addFeature(p)})})}e(document).ready(function(){e("#sg-close-all").click(function(i){e(".sg-data").fadeOut("fast",function(){e(this).remove()});i.preventDefault()});c.initialize();f(e("body"))});function g(i,j){var k=new ol.Feature({geometry:new ol.geom.Point(i)});k.setStyle(j);return k}mapIconStyle=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"/img/marker-icon.png"}))})})(jQuery);