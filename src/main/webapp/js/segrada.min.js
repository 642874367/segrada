(function(h){var i=new Bloodhound({datumTokenizer:function(l){return Bloodhound.tokenizers.whitespace(l.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var a=new Bloodhound({datumTokenizer:function(l){return Bloodhound.tokenizers.whitespace(l.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(m,n){var o=m+n;var l=h(".sg-node-search").filter(":focus");var q=h("#"+l.attr("data-select-id")+" option").filter(":selected");var p=q.attr(l.attr("data-attr"));if(p!=null&&p.length>0){o+="&tags="+encodeURIComponent(p)}return o}}});var c=new Bloodhound({datumTokenizer:function(l){return Bloodhound.tokenizers.whitespace(l.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var f=new Bloodhound({datumTokenizer:function(l){return Bloodhound.tokenizers.whitespace(l.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});var g=(typeof google==="object"&&typeof google.maps==="object")?new google.maps.Geocoder():null;h.fn.onEnter=function(l){this.bind("keypress",function(m){if(m.keyCode==13){l.apply(this,[m])}});return this};var b=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function j(q,p,o,l,n){var m=urlSegradaPictogramSearch+encodeURIComponent(n);h.getJSON(m,function(s){var r=[];h.each(s,function(t,u){var v=h("<div/>").text(u.title).html();r.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+u.id+'" data-uid="'+u.uid+'" title="'+v+'"><img src="'+urlSegradaPictogramFile+u.uid+'" width="24" height="24" alt="'+v+'" /></a></div>')});p.html("<div class='row'>"+r.join("")+"</div>");h("a",p).click(function(w){var v=h(this).attr("data-id");var u=h(this).attr("data-uid");var t=h("<div/>").text(h(this).attr("title")).html();h("#value-"+o,l).val(v);h("#preview-"+o,l).html('<img src="'+urlSegradaPictogramFile+u+'" width="24" height="24" alt="'+t+'" /> '+t);h("#clear-"+o,l).show();w.preventDefault();q.modal("hide")})})}function k(l){l=l||h("body");h(".sg-data").addClass("sg-dynamic-data");h(".sg-headbox-right").show();h(".sg-dynamic-hide").hide();h(".sg-data-add",l).click(function(m){h.get(h(this).attr("href"),function(q){var p=q.match(b);if(p!=null&&p.length>=2){h("#"+p[2]).remove()}var o=h("#sg-data");o.prepend(q);var n=o.children(":first");k(n);h("html, body").animate({scrollTop:n.offset().top},500)});m.preventDefault()});h(".sg-control-form",l).ajaxForm({beforeSubmit:function(m,o,p){var q=o.attr("data-target-id");if(typeof q=="undefined"||q==null||q.length==0){q="#sg-control"}var n=h(q);n.wrapInner("<div class='sg-disabled'></div>");n.prepend(h("#sg-wait").html());return true},success:function(o,q,r,n){var p=n.attr("data-target-id");if(typeof p=="undefined"||p==null||p.length==0){p="#sg-control"}var m=h(p);m.html(o);k(m)}});h(".sg-control-set",l).click(function(p){var o=h(this);var n=o.attr("data-target-id");if(typeof n=="undefined"||n==null||n.length==0){n="#sg-control"}var m=h(n);m.wrapInner("<div class='sg-disabled'></div>");m.prepend(h("#sg-wait").html());h.get(o.attr("href"),function(q){m.html(q);k(m)});p.preventDefault()});h("[data-data-dblclick]",l).dblclick(function(){h.get(h(this).attr("data-data-dblclick"),function(p){var o=p.match(b);if(o!=null&&o.length>=2){h("#"+o[2]).remove()}var n=h("#sg-data");n.prepend(p);var m=n.children(":first");k(m);h("html, body").animate({scrollTop:m.offset().top},500)})});h("tr [data-confirm]",l).click(function(n){var m=h(this);if(confirm(m.attr("data-confirm"))){var o=m.closest("tr");o.addClass("sg-disabled");h.get(m.attr("href"),function(p){o.slideUp("fast",function(){o.remove()})})}n.preventDefault()});h(".sg-replace-content",l).on("shown.bs.tab",function(o){var n=h(h(this).attr("href"));var m=h(this).attr("data-url");h.get(m,function(p){n.html(p);k(n)});h(this).removeClass("sg-replace-content");h(this).unbind("shown.bs.tab")});h(".sg-data-close",l).click(function(m){h(this).parent().parent().fadeOut("fast",function(){h(this).remove()})});h("input.sg-fileupload",l).fileinput({showUpload:false});h("input.sg-fileupload-small",l).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});h(".sg-pictogram-modal").on("shown.bs.modal",function(){var p=h(this);var o=p.attr("id");var n=h("#container-"+o,p);var m=h("#filter-"+o,p);m.on("input propertychange paste",function(){j(p,n,o,l,h(this).val())}).onEnter(function(){var r=h(".sg-pictogram-modal-link",n).first();if(r.length>0){var t=r.attr("data-id");var s=r.attr("data-id");var q=h("<div/>").text(r.attr("title")).html();h("#value-"+o,l).val(t);h("#preview-"+o,l).html('<img src="'+urlSegradaPictogramFile+s+'" width="24" height="24" alt="'+q+'" /> '+q);h("#clear-"+o,l).show();p.modal("hide")}});if(m.val()===""){j(p,n,o,l,"")}});h(".sg-pictogram-chooser",l).click(function(m){h("#"+h(this).attr("data-id")).modal("show");m.preventDefault()});h(".sg-pictogram-clearer",l).click(function(n){var m=h(this).attr("data-id");h("#value-"+m,l).val("");h("#preview-"+m,l).html("");h(this).hide();n.preventDefault()});h(".sg-source-ref-modal").on("shown.bs.modal",function(){var o=h(this);var n=o.attr("id");var m=h(".modal-body",o);h.get(o.attr("data-href"),function(p){m.html(p);h("form",m).ajaxForm({beforeSubmit:function(q,r,s){r.wrapInner("<div class='sg-disabled'></div>");r.prepend(h("#sg-wait").html());return true},success:function(r,t,u,q){var s=h(o.attr("data-target"));s.html(r);k(s);o.modal("hide")}})})}).on("hidden.bs.modal",function(){h(".modal-body",h(this)).html(h("#sg-wait").html())});h(".sg-source-ref-editor",l).click(function(n){var m=h("#"+h(this).attr("data-id"));m.attr("data-href",h(this).attr("href"));m.modal("show");n.preventDefault()});h(".sg-taglist-contract",l).each(function(){var m=h("span",h(this));if(m.length>1){m.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');h("span.sg-tag-show",h(this)).click(function(){h(this).remove();m.show()})}});h("select.sg-colorpicker",l).simplepicker({theme:"fontawesome"});h("select.sg-tags",l).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:i.ttAdapter()}});h("input.sg-node-search",l).each(function(){var n=h(this);var m=h("#"+n.attr("data-id"));n.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:a.ttAdapter()}).bind("typeahead:selected",function(p,o){m.val(o.id)}).bind("keyup",function(){if(!this.value){m.val("")}})});h("input.sg-file-search",l).each(function(){var n=h(this);var m=h("#"+n.attr("data-id"));n.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:c.ttAdapter()}).bind("typeahead:selected",function(p,o){m.val(o.id)}).bind("keyup",function(){if(!this.value){m.val("")}})});h("input.sg-source-search",l).each(function(){var n=h(this);var m=h("#"+n.attr("data-id"));n.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:f.ttAdapter()}).bind("typeahead:selected",function(p,o){m.val(o.id)}).bind("keyup",function(){if(!this.value){m.val("")}})});h(".sg-link-external").click(function(o){var m=h(this).attr("href");var n=window.open(m,"_blank");n.focus();o.preventDefault()});h("form.sg-data-form",l).ajaxForm({beforeSubmit:function(m,n,o){h(":input",n).attr("disabled",true);return true},success:function(o,q,r,m){var p=m.attr("data-id");if(typeof p!=="undefined"){p=h("#"+p)}p=p||m;p.replaceWith(o);var n=o.match(b);if(n!=null&&n.length>=2){k(h("#"+n[2]))}}});h(".sg-periods").each(function(){var m=h(this);var o=m.attr("id");var n=h(".sg-period-form",m);h(".sg-period-add",m).click(function(p){h(this).hide();n.show();p.preventDefault()});h(".sg-period-form-period",m).change(function(p){if(h(this).is(":checked")){h(".sg-period-toggle",m).show()}else{h(".sg-period-toggle",m).hide()}});n.ajaxForm({beforeSubmit:function(p,q,r){m.addClass("disabled");return true},success:function(q,r,s,p){m.replaceWith(q);k(m)}})});h(".sg-geotab",l).on("shown.bs.tab",function(r){var q=h(r.target);if(q.attr("data-created")=="1"){return}q.attr("data-created","1");var s=q.attr("data-locations-id");var n=h(s);var p=h(".sg-map-form",n);var o=h(".sg-geocomplete",p);var m=new google.maps.LatLng(0,0);o.geocomplete({map:s+"-map",details:s+"-form",markerOptions:{draggable:true},mapOptions:{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:1,center:m,scrollwheel:true,draggable:true}}).bind("geocode:result",function(u,t){h("input[type=submit]",p).show()}).bind("geocode:dragged",function(u,t){h("input[name=lat]",p).val(t.lat());h("input[name=lng]",p).val(t.lng())});h(".sg-map-add-marker",n).click(function(t){h(this).hide();p.show();t.preventDefault()});d(s,h(s+"-markers",n),o);h(s+"-map").on("destroyed",function(){if(typeof e[s]!=="undefined"){for(var t=0;t<e[s].length;t++){e[s][t].setMap(null)}delete e[s]}});h(".sg-geocomplete-find",p).click(function(){o.trigger("geocode")}).click();p.ajaxForm({beforeSubmit:function(t,u,v){n.addClass("disabled");return true},success:function(u,v,w,t){n.removeClass("disabled");h(s+"-markers",n).replaceWith(u);d(s,h(s+"-markers",n),o)}})})}var e=[];function d(r,m,l){var q=l.geocomplete("map");if(typeof e[r]!=="undefined"){for(var n=0;n<e[r].length;n++){e[r][n].setMap(null)}delete e[r]}e[r]=[];var p=h(r+"-delete").html();var o=new google.maps.LatLngBounds();h(".sg-location-marker",m).each(function(){var t=new google.maps.LatLng(h(this).attr("data-lat"),h(this).attr("data-lng"));o.extend(t);var u=h(this).attr("data-id");var v=new google.maps.InfoWindow({content:"<p>"+h(this).attr("data-lat")+","+h(this).attr("data-lng")+'</p><p><a href="'+h(this).attr("data-delete")+'" id="'+u+'">'+p+"</a></p>"});var s=new google.maps.Marker({position:t,map:q,icon:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"});google.maps.event.addListener(s,"click",function(){v.open(q,s);var w=h("#"+u);w.unbind("click");w.click(function(x){h.get(h(this).attr("href"),function(y){m.replaceWith(y);d(r,h(r+"-markers"),l)});x.preventDefault()})});e[r][e[r].length]=s});if(e[r].length==0){q.setZoom(1);q.setCenter(new google.maps.LatLng(0,0))}else{q.fitBounds(o)}}h.event.special.destroyed={remove:function(l){if(l.handler){l.handler()}}};h(document).ready(function(){h("#sg-close-all").click(function(l){h(".sg-data").fadeOut("fast",function(){h(this).remove()});l.preventDefault()});h(".sg-locale").click(function(l){h.get(h(this).attr("href"),function(n){var m=h("#sg-base").html();if(n!=""){window.location.href=m}});l.preventDefault()});i.initialize();k(h("body"))})})(jQuery);