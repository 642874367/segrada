(function(c){var g=new Bloodhound({datumTokenizer:function(t){return Bloodhound.tokenizers.whitespace(t.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var i=new Bloodhound({datumTokenizer:function(t){return Bloodhound.tokenizers.whitespace(t.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(u,v){var w=u+v;var t=c(".sg-node-search").filter(":focus");var y=c("#"+t.attr("data-select-id")+" option").filter(":selected");var x=y.attr(t.attr("data-attr"));if(x!=null&&x.length>0){w+="&tags="+encodeURIComponent(x)}return w}}});var l=new Bloodhound({datumTokenizer:function(t){return Bloodhound.tokenizers.whitespace(t.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var s=new Bloodhound({datumTokenizer:function(t){return Bloodhound.tokenizers.whitespace(t.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});var k=(typeof google==="object"&&typeof google.maps==="object")?new google.maps.Geocoder():null;var h=false;var e=new vis.DataSet([]);var p=new vis.DataSet([]);var a=null;c.fn.onEnter=function(t){this.bind("keypress",function(u){if(u.keyCode==13){t.apply(this,[u])}});return this};var j=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function d(y,x,w,t,v){var u=urlSegradaPictogramSearch+encodeURIComponent(v);c.getJSON(u,function(A){var z=[];c.each(A,function(B,C){var D=c("<div/>").text(C.title).html();z.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+C.id+'" data-uid="'+C.uid+'" title="'+D+'"><img src="'+urlSegradaPictogramFile+C.uid+'" width="24" height="24" alt="'+D+'" /></a></div>')});x.html("<div class='row'>"+z.join("")+"</div>");c("a",x).click(function(E){var D=c(this).attr("data-id");var C=c(this).attr("data-uid");var B=c("<div/>").text(c(this).attr("title")).html();c("#value-"+w,t).val(D);c("#preview-"+w,t).html('<img src="'+urlSegradaPictogramFile+C+'" width="24" height="24" alt="'+B+'" /> '+B);c("#clear-"+w,t).show();E.preventDefault();y.modal("hide")})})}function m(t){t=t||c("body");c(".sg-data").addClass("sg-dynamic-data");c(".sg-headbox-right").show();c(".sg-dynamic-hide").hide();c(".sg-data-add",t).click(function(u){c.get(c(this).attr("href"),function(y){var x=y.match(j);if(x!=null&&x.length>=2){c("#"+x[2]).remove()}var w=c("#sg-data");w.prepend(y);var v=w.children(":first");m(v);c("html, body").animate({scrollTop:v.offset().top},500)});u.preventDefault()});c(".sg-control-form",t).ajaxForm({beforeSubmit:function(u,w,x){var y=w.attr("data-target-id");if(typeof y=="undefined"||y==null||y.length==0){y="#sg-control"}var v=c(y);v.wrapInner("<div class='sg-disabled'></div>");v.prepend(c("#sg-wait").html());return true},success:function(w,y,z,v){var x=v.attr("data-target-id");if(typeof x=="undefined"||x==null||x.length==0){x="#sg-control"}var u=c(x);u.html(w);m(u)}});c(".sg-control-set",t).click(function(x){var w=c(this);var v=w.attr("data-target-id");if(typeof v=="undefined"||v==null||v.length==0){v="#sg-control";f()}var u=c(v);u.wrapInner("<div class='sg-disabled'></div>");u.prepend(c("#sg-wait").html());c.get(w.attr("href"),function(y){u.html(y);m(u)});x.preventDefault()});c("[data-data-dblclick]",t).dblclick(function(){c.get(c(this).attr("data-data-dblclick"),function(x){var w=x.match(j);if(w!=null&&w.length>=2){c("#"+w[2]).remove()}var v=c("#sg-data");v.prepend(x);var u=v.children(":first");m(u);c("html, body").animate({scrollTop:u.offset().top},500)})});c("tr [data-confirm]",t).click(function(v){var u=c(this);if(confirm(u.attr("data-confirm"))){var w=u.closest("tr");w.addClass("sg-disabled");c.get(u.attr("href"),function(x){w.slideUp("fast",function(){w.remove()})})}v.preventDefault()});c(".sg-replace-content",t).on("shown.bs.tab",function(w){var v=c(c(this).attr("href"));var u=c(this).attr("data-url");c.get(u,function(x){v.html(x);m(v)});c(this).removeClass("sg-replace-content");c(this).unbind("shown.bs.tab")});c(".sg-data-close",t).click(function(u){c(this).parent().parent().fadeOut("fast",function(){c(this).remove()})});c("input.sg-fileupload",t).fileinput({showUpload:false});c("input.sg-fileupload-small",t).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});c(".sg-pictogram-modal").on("shown.bs.modal",function(){var x=c(this);var w=x.attr("id");var v=c("#container-"+w,x);var u=c("#filter-"+w,x);u.on("input propertychange paste",function(){d(x,v,w,t,c(this).val())}).onEnter(function(){var z=c(".sg-pictogram-modal-link",v).first();if(z.length>0){var B=z.attr("data-id");var A=z.attr("data-id");var y=c("<div/>").text(z.attr("title")).html();c("#value-"+w,t).val(B);c("#preview-"+w,t).html('<img src="'+urlSegradaPictogramFile+A+'" width="24" height="24" alt="'+y+'" /> '+y);c("#clear-"+w,t).show();x.modal("hide")}});if(u.val()===""){d(x,v,w,t,"")}});c(".sg-pictogram-chooser",t).click(function(u){c("#"+c(this).attr("data-id")).modal("show");u.preventDefault()});c(".sg-pictogram-clearer",t).click(function(v){var u=c(this).attr("data-id");c("#value-"+u,t).val("");c("#preview-"+u,t).html("");c(this).hide();v.preventDefault()});c(".sg-source-ref-modal").on("shown.bs.modal",function(){var w=c(this);var v=w.attr("id");var u=c(".modal-body",w);c.get(w.attr("data-href"),function(x){u.html(x);c("form",u).ajaxForm({beforeSubmit:function(y,z,A){z.wrapInner("<div class='sg-disabled'></div>");z.prepend(c("#sg-wait").html());return true},success:function(z,B,C,y){var A=c(w.attr("data-target"));A.html(z);m(A);w.modal("hide")}})})}).on("hidden.bs.modal",function(){c(".modal-body",c(this)).html(c("#sg-wait").html())});c(".sg-source-ref-editor",t).click(function(v){var u=c("#"+c(this).attr("data-id"));u.attr("data-href",c(this).attr("href"));u.modal("show");v.preventDefault()});c(".sg-taglist-contract",t).each(function(){var u=c("span",c(this));if(u.length>1){u.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');c("span.sg-tag-show",c(this)).click(function(){c(this).remove();u.show()})}});c("select.sg-colorpicker",t).simplepicker({theme:"fontawesome"});c("select.sg-tags",t).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:g.ttAdapter()}});c("input.sg-node-search",t).each(function(){var v=c(this);var u=c("#"+v.attr("data-id"));v.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:i.ttAdapter()}).bind("typeahead:selected",function(x,w){u.val(w.id)}).bind("keyup",function(){if(!this.value){u.val("")}})});c("input.sg-file-search",t).each(function(){var v=c(this);var u=c("#"+v.attr("data-id"));v.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:l.ttAdapter()}).bind("typeahead:selected",function(x,w){u.val(w.id)}).bind("keyup",function(){if(!this.value){u.val("")}})});c("input.sg-source-search",t).each(function(){var v=c(this);var u=c("#"+v.attr("data-id"));v.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:s.ttAdapter()}).bind("typeahead:selected",function(x,w){u.val(w.id)}).bind("keyup",function(){if(!this.value){u.val("")}})});c(".sg-link-external").click(function(w){var u=c(this).attr("href");var v=window.open(u,"_blank");v.focus();w.preventDefault()});c("form.sg-data-form",t).ajaxForm({beforeSubmit:function(u,v,w){c(":input",v).attr("disabled",true);return true},success:function(w,y,z,u){var x=u.attr("data-id");if(typeof x!=="undefined"){x=c("#"+x)}x=x||u;x.replaceWith(w);var v=w.match(j);if(v!=null&&v.length>=2){m(c("#"+v[2]))}}});c("form.sg-simple-form",t).ajaxForm({beforeSubmit:function(u,v,w){c(":input",v).attr("disabled",true);var x=v.attr("data-id");if(typeof x!=="undefined"){x=c("#"+x)}x=x||v;x.html(c("#sg-wait"));return true},success:function(v,x,y,u){var w=u.attr("data-id");if(typeof w!=="undefined"){w=c("#"+w)}w=w||u;w.html(v);c(":input",u).attr("disabled",false)}});c(".sg-periods").each(function(){var u=c(this);var w=u.attr("id");var v=c(".sg-period-form",u);c(".sg-period-add",u).click(function(x){c(this).hide();v.show();x.preventDefault()});c(".sg-period-form-period",u).change(function(x){if(c(this).is(":checked")){c(".sg-period-toggle",u).show()}else{c(".sg-period-toggle",u).hide()}});v.ajaxForm({beforeSubmit:function(x,y,z){u.addClass("disabled");return true},success:function(y,z,A,x){u.replaceWith(y);m(u)}})});c(".sg-geotab",t).on("shown.bs.tab",function(z){var y=c(z.target);if(y.attr("data-created")=="1"){return}y.attr("data-created","1");var A=y.attr("data-locations-id");var v=c(A);var x=c(".sg-map-form",v);var w=c(".sg-geocomplete",x);var u=new google.maps.LatLng(0,0);w.geocomplete({map:A+"-map",details:A+"-form",markerOptions:{draggable:true},mapOptions:{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:1,center:u,scrollwheel:true,draggable:true}}).bind("geocode:result",function(C,B){c("input[type=submit]",x).show()}).bind("geocode:dragged",function(C,B){c("input[name=lat]",x).val(B.lat());c("input[name=lng]",x).val(B.lng())});c(".sg-map-add-marker",v).click(function(B){c(this).hide();x.show();B.preventDefault()});q(A,c(A+"-markers",v),w);c(A+"-map").on("destroyed",function(){if(typeof n[A]!=="undefined"){for(var B=0;B<n[A].length;B++){n[A][B].setMap(null)}delete n[A]}});c(".sg-geocomplete-find",x).click(function(){w.trigger("geocode")}).click();x.ajaxForm({beforeSubmit:function(B,C,D){v.addClass("disabled");return true},success:function(C,D,E,B){v.removeClass("disabled");c(A+"-markers",v).replaceWith(C);q(A,c(A+"-markers",v),w)}})});c("a.sg-graph-update",t).click(function(u){r(c(this).attr("href"));u.preventDefault()})}var n=[];function q(z,u,t){var y=t.geocomplete("map");if(typeof n[z]!=="undefined"){for(var v=0;v<n[z].length;v++){n[z][v].setMap(null)}delete n[z]}n[z]=[];var x=c(z+"-delete").html();var w=new google.maps.LatLngBounds();c(".sg-location-marker",u).each(function(){var B=new google.maps.LatLng(c(this).attr("data-lat"),c(this).attr("data-lng"));w.extend(B);var C=c(this).attr("data-id");var D=new google.maps.InfoWindow({content:"<p>"+c(this).attr("data-lat")+","+c(this).attr("data-lng")+'</p><p><a href="'+c(this).attr("data-delete")+'" id="'+C+'">'+x+"</a></p>"});var A=new google.maps.Marker({position:B,map:y,icon:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"});google.maps.event.addListener(A,"click",function(){D.open(y,A);var E=c("#"+C);E.unbind("click");E.click(function(F){c.get(c(this).attr("href"),function(G){u.replaceWith(G);q(z,c(z+"-markers"),t)});F.preventDefault()})});n[z][n[z].length]=A});if(n[z].length==0){y.setZoom(1);y.setCenter(new google.maps.LatLng(0,0))}else{y.fitBounds(w)}}function b(){if(!h){h=true;var t=document.getElementById("sg-graph");var v={nodes:e,edges:p};var u={};a=new vis.Network(t,v,u);if(typeof console!="undefined"){console.log("Graph Network was initialized.")}}}function f(){var t=c("#sg-toggle-graph");if(t.hasClass("active")){t.removeClass("active");c(".fa-share-alt-square",t).addClass("fa-share-alt").removeClass("fa-share-alt-square");c("#sg-graph-container").hide();c("#sg-control").show()}}function o(){var t=c("#sg-toggle-graph");if(!t.hasClass("active")){t.addClass("active");c(".fa-share-alt",t).addClass("fa-share-alt-square").removeClass("fa-share-alt");c("#sg-control").hide();c("#sg-graph-container").show();b()}}function r(t){o();e.update({id:1,label:"Node 1"})}c.event.special.destroyed={remove:function(t){if(t.handler){t.handler()}}};c(document).ready(function(){c("#sg-close-all").click(function(t){c(".sg-data").fadeOut("fast",function(){c(this).remove()});t.preventDefault()});c(".sg-locale").click(function(t){c.get(c(this).attr("href"),function(v){var u=c("#sg-base").html();if(v!=""){window.location.href=u}});t.preventDefault()});g.initialize();c("#sg-graph-container").hide();c("#sg-toggle-graph").click(function(t){if(c(this).hasClass("active")){f()}else{o()}t.preventDefault()});m(c("body"))})})(jQuery);