(function(d){var b=new Bloodhound({datumTokenizer:function(g){return Bloodhound.tokenizers.whitespace(g.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var f=new Bloodhound({datumTokenizer:function(g){return Bloodhound.tokenizers.whitespace(g.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(h,i){var j=h+i;var g=d(".sg-node-search").filter(":focus");var l=d("#"+g.attr("data-select-id")+" option").filter(":selected");var k=l.attr(g.attr("data-attr"));if(k!=null&&k.length>0){j+="&tags="+encodeURIComponent(k)}return j}}});d.fn.onEnter=function(g){this.bind("keypress",function(h){if(h.keyCode==13){g.apply(this,[h])}});return this};var a=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function c(l,k,j,g,i){var h=urlSegradaPictogramSearch+encodeURIComponent(i);d.getJSON(h,function(n){var m=[];d.each(n,function(o,p){var q=d("<div/>").text(p.title).html();m.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+p.id+'" data-uid="'+p.uid+'" title="'+q+'"><img src="'+urlSegradaPictogramFile+p.uid+'" width="24" height="24" alt="'+q+'" /></a></div>')});k.html("<div class='row'>"+m.join("")+"</div>");d("a",k).click(function(r){var q=d(this).attr("data-id");var p=d(this).attr("data-uid");var o=d("<div/>").text(d(this).attr("title")).html();d("#value-"+j,g).val(q);d("#preview-"+j,g).html('<img src="'+urlSegradaPictogramFile+p+'" width="24" height="24" alt="'+o+'" /> '+o);d("#clear-"+j,g).show();r.preventDefault();l.modal("hide")})})}function e(g){g=g||d("body");d(".sg-data").addClass("sg-dynamic-data");var h=d(".sg-closeable");h.prepend('<div class="sg-headbox-right"><a href="#" type="button" class="close sg-data-close" aria-label="Close"><span aria-hidden="true">&times;</span></a></div>');h.removeClass("sg-closeable");d(".sg-dynamic-hide").hide();d(".sg-data-add",g).click(function(i){d.get(d(this).attr("href"),function(m){var l=m.match(a);if(l!=null&&l.length>=2){d("#"+l[2]).remove()}var k=d("#sg-data");k.prepend(m);var j=k.children(":first");e(j)});i.preventDefault()});d(".sg-control-set",g).click(function(i){d.get(d(this).attr("href"),function(k){var j=d("#sg-control");j.html(k);e(j)});i.preventDefault()});d("[data-data-dblclick]",g).dblclick(function(){d.get(d(this).attr("data-data-dblclick"),function(l){var k=l.match(a);if(k!=null&&k.length>=2){d("#"+k[2]).remove()}var j=d("#sg-data");j.prepend(l);var i=j.children(":first");e(i)})});d("[data-confirm]",g).click(function(i){if(confirm(d(this).attr("data-confirm"))){if(d(this).hasClass("sg-control-confirm")){d.get(d(this).attr("href"),function(k){var j=d("#sg-control");j.html(k);e(j)})}}i.preventDefault()});d(".sg-data-close",g).click(function(i){d(this).parent().parent().fadeOut("fast",function(){d(this).remove()})});d("input.sg-fileupload",g).fileinput({showUpload:false});d("input.sg-fileupload-small",g).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});d(".sg-pictogram-modal").on("shown.bs.modal",function(){var l=d(this);var k=l.attr("id");var j=d("#container-"+k,l);var i=d("#filter-"+k,l);i.on("input propertychange paste",function(){c(l,j,k,g,d(this).val())}).onEnter(function(){var n=d(".sg-pictogram-modal-link",j).first();if(n.length>0){var p=n.attr("data-id");var o=n.attr("data-id");var m=d("<div/>").text(n.attr("title")).html();d("#value-"+k,g).val(p);d("#preview-"+k,g).html('<img src="'+urlSegradaPictogramFile+o+'" width="24" height="24" alt="'+m+'" /> '+m);d("#clear-"+k,g).show();l.modal("hide")}});if(i.val()===""){c(l,j,k,g,"")}});d(".sg-pictogram-chooser",g).click(function(i){d("#"+d(this).attr("data-id")).modal("show");i.preventDefault()});d(".sg-pictogram-clearer",g).click(function(j){var i=d(this).attr("data-id");d("#value-"+i,g).val("");d("#preview-"+i,g).html("");d(this).hide();j.preventDefault()});d("select.sg-colorpicker",g).simplepicker({theme:"fontawesome"});d("select.sg-tags",g).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:b.ttAdapter()}});d("input.sg-node-search",g).each(function(){var j=d(this);var i=d("#"+j.attr("data-id"));j.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:f.ttAdapter()}).bind("typeahead:selected",function(l,k){i.val(k.id)}).bind("keyup",function(){if(!this.value){i.val("")}})});d("form.sg-data-form",g).ajaxForm({beforeSubmit:function(i,j,k){d(":input",j).attr("disabled",true);return true},success:function(k,m,n,i){var l=i.attr("data-id");if(typeof l!=="undefined"){l=d("#"+l)}l=l||i;l.replaceWith(k);var j=k.match(a);if(j!=null&&j.length>=2){e(d("#"+j[2]))}}})}d(document).ready(function(){d("#sg-close-all").click(function(g){d(".sg-data").fadeOut("fast",function(){d(this).remove()});g.preventDefault()});d(".sg-control-form").ajaxForm({success:function(i,j,k,h){var g=d("#sg-control");g.html(i);e(g)}});b.initialize();e(d("body"))})})(jQuery);