(function(c){var g=new Bloodhound({datumTokenizer:function(u){return Bloodhound.tokenizers.whitespace(u.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var i=new Bloodhound({datumTokenizer:function(u){return Bloodhound.tokenizers.whitespace(u.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(v,w){var x=v+w;var u=c(".sg-node-search").filter(":focus");var z=c("#"+u.attr("data-select-id")+" option").filter(":selected");var y=z.attr(u.attr("data-attr"));if(y!=null&&y.length>0){x+="&tags="+encodeURIComponent(y)}return x}}});var m=new Bloodhound({datumTokenizer:function(u){return Bloodhound.tokenizers.whitespace(u.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var t=new Bloodhound({datumTokenizer:function(u){return Bloodhound.tokenizers.whitespace(u.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});var l=(typeof google==="object"&&typeof google.maps==="object")?new google.maps.Geocoder():null;var h=false;var e=new vis.DataSet([]);var q=new vis.DataSet([]);var a=null;c.fn.onEnter=function(u){this.bind("keypress",function(v){if(v.keyCode==13){u.apply(this,[v])}});return this};var j=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function d(z,y,x,u,w){var v=urlSegradaPictogramSearch+encodeURIComponent(w);c.getJSON(v,function(B){var A=[];c.each(B,function(C,D){var E=c("<div/>").text(D.title).html();A.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+D.id+'" data-uid="'+D.uid+'" title="'+E+'"><img src="'+urlSegradaPictogramFile+D.uid+'" width="24" height="24" alt="'+E+'" /></a></div>')});y.html("<div class='row'>"+A.join("")+"</div>");c("a",y).click(function(F){var E=c(this).attr("data-id");var D=c(this).attr("data-uid");var C=c("<div/>").text(c(this).attr("title")).html();c("#value-"+x,u).val(E);c("#preview-"+x,u).html('<img src="'+urlSegradaPictogramFile+D+'" width="24" height="24" alt="'+C+'" /> '+C);c("#clear-"+x,u).show();F.preventDefault();z.modal("hide")})})}function k(u){c.get(u,function(y){var x=y.match(j);if(x!=null&&x.length>=2){c("#"+x[2]).remove()}var w=c("#sg-data");w.prepend(y);var v=w.children(":first");n(v);c("html, body").animate({scrollTop:v.offset().top},500)})}function n(u){u=u||c("body");c(".sg-data").addClass("sg-dynamic-data");c(".sg-headbox-right").show();c(".sg-dynamic-hide").hide();c(".sg-data-add",u).click(function(v){k(c(this).attr("href"));v.preventDefault()});c(".sg-control-form",u).ajaxForm({beforeSubmit:function(v,x,y){var z=x.attr("data-target-id");if(typeof z=="undefined"||z==null||z.length==0){z="#sg-control";f()}var w=c(z);w.wrapInner("<div class='sg-disabled'></div>");w.prepend(c("#sg-wait").html());return true},success:function(x,z,A,w){var y=w.attr("data-target-id");if(typeof y=="undefined"||y==null||y.length==0){y="#sg-control"}var v=c(y);v.html(x);n(v)}});c(".sg-control-set",u).click(function(y){var x=c(this);var w=x.attr("data-target-id");if(typeof w=="undefined"||w==null||w.length==0){w="#sg-control";f()}var v=c(w);v.wrapInner("<div class='sg-disabled'></div>");v.prepend(c("#sg-wait").html());c.get(x.attr("href"),function(z){v.html(z);n(v)});y.preventDefault()});c("[data-data-dblclick]",u).dblclick(function(){c.get(c(this).attr("data-data-dblclick"),function(y){var x=y.match(j);if(x!=null&&x.length>=2){c("#"+x[2]).remove()}var w=c("#sg-data");w.prepend(y);var v=w.children(":first");n(v);c("html, body").animate({scrollTop:v.offset().top},500)})});c("tr [data-confirm]",u).click(function(w){var v=c(this);if(confirm(v.attr("data-confirm"))){var x=v.closest("tr");x.addClass("sg-disabled");c.get(v.attr("href"),function(y){x.slideUp("fast",function(){x.remove()})})}w.preventDefault()});c(".sg-replace-content",u).on("shown.bs.tab",function(x){var w=c(c(this).attr("href"));var v=c(this).attr("data-url");c.get(v,function(y){w.html(y);n(w)});c(this).removeClass("sg-replace-content");c(this).unbind("shown.bs.tab")});c(".sg-data-close",u).click(function(v){c(this).parent().parent().fadeOut("fast",function(){c(this).remove()})});c("input.sg-fileupload",u).fileinput({showUpload:false});c("input.sg-fileupload-small",u).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});c(".sg-pictogram-modal").on("shown.bs.modal",function(){var y=c(this);var x=y.attr("id");var w=c("#container-"+x,y);var v=c("#filter-"+x,y);v.on("input propertychange paste",function(){d(y,w,x,u,c(this).val())}).onEnter(function(){var A=c(".sg-pictogram-modal-link",w).first();if(A.length>0){var C=A.attr("data-id");var B=A.attr("data-id");var z=c("<div/>").text(A.attr("title")).html();c("#value-"+x,u).val(C);c("#preview-"+x,u).html('<img src="'+urlSegradaPictogramFile+B+'" width="24" height="24" alt="'+z+'" /> '+z);c("#clear-"+x,u).show();y.modal("hide")}});if(v.val()===""){d(y,w,x,u,"")}});c(".sg-pictogram-chooser",u).click(function(v){c("#"+c(this).attr("data-id")).modal("show");v.preventDefault()});c(".sg-pictogram-clearer",u).click(function(w){var v=c(this).attr("data-id");c("#value-"+v,u).val("");c("#preview-"+v,u).html("");c(this).hide();w.preventDefault()});c(".sg-source-ref-modal").on("shown.bs.modal",function(){var x=c(this);var w=x.attr("id");var v=c(".modal-body",x);c.get(x.attr("data-href"),function(y){v.html(y);c("form",v).ajaxForm({beforeSubmit:function(z,A,B){A.wrapInner("<div class='sg-disabled'></div>");A.prepend(c("#sg-wait").html());return true},success:function(A,C,D,z){var B=c(x.attr("data-target"));B.html(A);n(B);x.modal("hide")}})})}).on("hidden.bs.modal",function(){c(".modal-body",c(this)).html(c("#sg-wait").html())});c(".sg-source-ref-editor",u).click(function(w){var v=c("#"+c(this).attr("data-id"));v.attr("data-href",c(this).attr("href"));v.modal("show");w.preventDefault()});c(".sg-taglist-contract",u).each(function(){var v=c("span",c(this));if(v.length>1){v.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');c("span.sg-tag-show",c(this)).click(function(){c(this).remove();v.show()})}});c("select.sg-colorpicker",u).simplepicker({theme:"fontawesome"});c("select.sg-tags",u).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:g.ttAdapter()}});c("input.sg-node-search",u).each(function(){var w=c(this);var v=c("#"+w.attr("data-id"));w.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:i.ttAdapter()}).bind("typeahead:selected",function(y,x){v.val(x.id)}).bind("keyup",function(){if(!this.value){v.val("")}})});c("input.sg-file-search",u).each(function(){var w=c(this);var v=c("#"+w.attr("data-id"));w.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:m.ttAdapter()}).bind("typeahead:selected",function(y,x){v.val(x.id)}).bind("keyup",function(){if(!this.value){v.val("")}})});c("input.sg-source-search",u).each(function(){var w=c(this);var v=c("#"+w.attr("data-id"));w.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:t.ttAdapter()}).bind("typeahead:selected",function(y,x){v.val(x.id)}).bind("keyup",function(){if(!this.value){v.val("")}})});c(".sg-link-external").click(function(x){var v=c(this).attr("href");var w=window.open(v,"_blank");w.focus();x.preventDefault()});c("form.sg-data-form",u).ajaxForm({beforeSubmit:function(v,w,x){c(":input",w).attr("disabled",true);return true},success:function(x,z,A,v){var y=v.attr("data-id");if(typeof y!=="undefined"){y=c("#"+y)}y=y||v;y.replaceWith(x);var w=x.match(j);if(w!=null&&w.length>=2){n(c("#"+w[2]))}}});c("form.sg-simple-form",u).ajaxForm({beforeSubmit:function(v,w,x){c(":input",w).attr("disabled",true);var y=w.attr("data-id");if(typeof y!=="undefined"){y=c("#"+y)}y=y||w;y.html(c("#sg-wait"));return true},success:function(w,y,z,v){var x=v.attr("data-id");if(typeof x!=="undefined"){x=c("#"+x)}x=x||v;x.html(w);c(":input",v).attr("disabled",false)}});c(".sg-periods").each(function(){var v=c(this);var x=v.attr("id");var w=c(".sg-period-form",v);c(".sg-period-add",v).click(function(y){c(this).hide();w.show();y.preventDefault()});c(".sg-period-form-period",v).change(function(y){if(c(this).is(":checked")){c(".sg-period-toggle",v).show()}else{c(".sg-period-toggle",v).hide()}});w.ajaxForm({beforeSubmit:function(y,z,A){v.addClass("disabled");return true},success:function(z,A,B,y){v.replaceWith(z);n(v)}})});c(".sg-geotab",u).on("shown.bs.tab",function(A){var z=c(A.target);if(z.attr("data-created")=="1"){return}z.attr("data-created","1");var B=z.attr("data-locations-id");var w=c(B);var y=c(".sg-map-form",w);var x=c(".sg-geocomplete",y);var v=new google.maps.LatLng(0,0);x.geocomplete({map:B+"-map",details:B+"-form",markerOptions:{draggable:true},mapOptions:{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:1,center:v,scrollwheel:true,draggable:true}}).bind("geocode:result",function(D,C){c("input[type=submit]",y).show()}).bind("geocode:dragged",function(D,C){c("input[name=lat]",y).val(C.lat());c("input[name=lng]",y).val(C.lng())});c(".sg-map-add-marker",w).click(function(C){c(this).hide();y.show();C.preventDefault()});r(B,c(B+"-markers",w),x);c(B+"-map").on("destroyed",function(){if(typeof o[B]!=="undefined"){for(var C=0;C<o[B].length;C++){o[B][C].setMap(null)}delete o[B]}});c(".sg-geocomplete-find",y).click(function(){x.trigger("geocode")}).click();y.ajaxForm({beforeSubmit:function(C,D,E){w.addClass("disabled");return true},success:function(D,E,F,C){w.removeClass("disabled");c(B+"-markers",w).replaceWith(D);r(B,c(B+"-markers",w),x)}})});c("a.sg-graph-update",u).click(function(v){s(c(this).attr("href"));v.preventDefault()})}var o=[];function r(A,v,u){var z=u.geocomplete("map");if(typeof o[A]!=="undefined"){for(var w=0;w<o[A].length;w++){o[A][w].setMap(null)}delete o[A]}o[A]=[];var y=c(A+"-delete").html();var x=new google.maps.LatLngBounds();c(".sg-location-marker",v).each(function(){var C=new google.maps.LatLng(c(this).attr("data-lat"),c(this).attr("data-lng"));x.extend(C);var D=c(this).attr("data-id");var E=new google.maps.InfoWindow({content:"<p>"+c(this).attr("data-lat")+","+c(this).attr("data-lng")+'</p><p><a href="'+c(this).attr("data-delete")+'" id="'+D+'">'+y+"</a></p>"});var B=new google.maps.Marker({position:C,map:z,icon:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"});google.maps.event.addListener(B,"click",function(){E.open(z,B);var F=c("#"+D);F.unbind("click");F.click(function(G){c.get(c(this).attr("href"),function(H){v.replaceWith(H);r(A,c(A+"-markers"),u)});G.preventDefault()})});o[A][o[A].length]=B});if(o[A].length==0){z.setZoom(1);z.setCenter(new google.maps.LatLng(0,0))}else{z.fitBounds(x)}}function b(){if(!h){h=true;var u=document.getElementById("sg-graph");var w={nodes:e,edges:q};var v={nodes:{shape:"icon",color:{border:"#000",background:"#fff"}},edges:{font:{size:10},labelHighlightBold:false,selectionWidth:0,arrows:{to:true},smooth:{type:"cubicBezier"}},groups:{node:{icon:{code:"\uf192",color:"#000000"}}}};a=new vis.Network(u,w,v);a.on("doubleClick",function(A){var x=null;if(A.nodes.length>0){var z=e.get(A.nodes[0]);if(z!=null&&z.url!=null){x=z.url}}else{if(A.edges.length>0){var y=q.get(A.edges[0]);if(y!=null&&y.url!=null){x=y.url}}}if(x!=null){k(x)}})}}function f(){var u=c("#sg-toggle-graph");if(u.hasClass("active")){u.removeClass("active");c(".fa-share-alt-square",u).addClass("fa-share-alt").removeClass("fa-share-alt-square");c("#sg-graph-container").hide();c("#sg-control").show();a.destroy();h=false}}function p(){var u=c("#sg-toggle-graph");if(!u.hasClass("active")){u.addClass("active");c(".fa-share-alt",u).addClass("fa-share-alt-square").removeClass("fa-share-alt");c("#sg-control").hide();c("#sg-graph-container").show();b()}}function s(v){if(v==null){alert("Null url!");return}p();var x=[];var y=[];var u=e.get({fields:["id"]});for(var w=0;w<u.length;w++){x.push(u[w].id)}u=q.get({fields:["id"]});for(var w=0;w<u.length;w++){y.push(u[w].id)}c.ajax({url:v,type:"POST",dataType:"json",data:JSON.stringify({nodes:x,edges:y}),success:function(A,B,z){if(A==null){alert("NULL data");return}if(A.error!=null){alert(A.error);return}if(A.nodes!=null&&A.nodes.length>0){e.update(A.nodes)}if(A.edges!=null&&A.edges.length>0){q.update(A.edges)}if(A.removeNodes!=null&&A.removeNodes.length>0){e.remove(A.removeNodes)}if(A.removeEdges!=null&&A.removeEdges.length>0){q.remove(A.removeEdges)}if(A.highlightNode!=null){a.unselectAll();a.selectNodes([A.highlightNode],false)}a.fit()}})}c.event.special.destroyed={remove:function(u){if(u.handler){u.handler()}}};c(document).ready(function(){c("#sg-close-all").click(function(u){c(".sg-data").fadeOut("fast",function(){c(this).remove()});u.preventDefault()});c(".sg-locale").click(function(u){c.get(c(this).attr("href"),function(w){var v=c("#sg-base").html();if(w!=""){window.location.href=v}});u.preventDefault()});g.initialize();c("#sg-toggle-graph").click(function(u){if(c(this).hasClass("active")){f()}else{p()}u.preventDefault()});c("#sg-graph-action-remove").click(function(v){var u=a.getSelection();if(u.edges.length>0){q.remove(u.edges)}if(u.nodes.length>0){e.remove(u.nodes)}v.preventDefault()});c("#sg-graph-action-restart").click(function(u){q.clear();e.clear();u.preventDefault()});c("#sg-graph-action-reload").click(function(u){a.destroy();h=false;b();u.preventDefault()});c("#sg-graph-action-fit").click(function(u){a.fit();u.preventDefault()});c("#sg-graph-close").click(function(u){f();u.preventDefault()});n(c("body"))})})(jQuery);