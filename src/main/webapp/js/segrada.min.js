(function(e){var f=new Bloodhound({datumTokenizer:function(j){return Bloodhound.tokenizers.whitespace(j.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var a=new Bloodhound({datumTokenizer:function(j){return Bloodhound.tokenizers.whitespace(j.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(k,l){var m=k+l;var j=e(".sg-node-search").filter(":focus");var o=e("#"+j.attr("data-select-id")+" option").filter(":selected");var n=o.attr(j.attr("data-attr"));if(n!=null&&n.length>0){m+="&tags="+encodeURIComponent(n)}return m}}});var c=new Bloodhound({datumTokenizer:function(j){return Bloodhound.tokenizers.whitespace(j.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var d=new Bloodhound({datumTokenizer:function(j){return Bloodhound.tokenizers.whitespace(j.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});e.fn.onEnter=function(j){this.bind("keypress",function(k){if(k.keyCode==13){j.apply(this,[k])}});return this};var b=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function g(o,n,m,j,l){var k=urlSegradaPictogramSearch+encodeURIComponent(l);e.getJSON(k,function(q){var p=[];e.each(q,function(r,s){var t=e("<div/>").text(s.title).html();p.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+s.id+'" data-uid="'+s.uid+'" title="'+t+'"><img src="'+urlSegradaPictogramFile+s.uid+'" width="24" height="24" alt="'+t+'" /></a></div>')});n.html("<div class='row'>"+p.join("")+"</div>");e("a",n).click(function(u){var t=e(this).attr("data-id");var s=e(this).attr("data-uid");var r=e("<div/>").text(e(this).attr("title")).html();e("#value-"+m,j).val(t);e("#preview-"+m,j).html('<img src="'+urlSegradaPictogramFile+s+'" width="24" height="24" alt="'+r+'" /> '+r);e("#clear-"+m,j).show();u.preventDefault();o.modal("hide")})})}function i(j){j=j||e("body");e(".sg-data").addClass("sg-dynamic-data");e(".sg-headbox-right").show();e(".sg-dynamic-hide").hide();e(".sg-data-add",j).click(function(k){e.get(e(this).attr("href"),function(o){var n=o.match(b);if(n!=null&&n.length>=2){e("#"+n[2]).remove()}var m=e("#sg-data");m.prepend(o);var l=m.children(":first");i(l);e("html, body").animate({scrollTop:l.offset().top},500)});k.preventDefault()});e(".sg-control-form",j).ajaxForm({beforeSubmit:function(k,m,n){var o=m.attr("data-target-id");if(typeof o=="undefined"||o==null||o.length==0){o="#sg-control"}var l=e(o);l.wrapInner("<div class='sg-disabled'></div>");l.prepend(e("#sg-wait").html());return true},success:function(m,o,p,l){var n=l.attr("data-target-id");if(typeof n=="undefined"||n==null||n.length==0){n="#sg-control"}var k=e(n);k.html(m);i(k)}});e(".sg-control-set",j).click(function(n){var m=e(this);var l=m.attr("data-target-id");if(typeof l=="undefined"||l==null||l.length==0){l="#sg-control"}var k=e(l);k.wrapInner("<div class='sg-disabled'></div>");k.prepend(e("#sg-wait").html());e.get(m.attr("href"),function(o){k.html(o);i(k)});n.preventDefault()});e("[data-data-dblclick]",j).dblclick(function(){e.get(e(this).attr("data-data-dblclick"),function(n){var m=n.match(b);if(m!=null&&m.length>=2){e("#"+m[2]).remove()}var l=e("#sg-data");l.prepend(n);var k=l.children(":first");i(k);e("html, body").animate({scrollTop:k.offset().top},500)})});e("tr [data-confirm]",j).click(function(l){var k=e(this);if(confirm(k.attr("data-confirm"))){var m=k.closest("tr");m.addClass("sg-disabled");e.get(k.attr("href"),function(n){m.slideUp("fast",function(){m.remove()})})}l.preventDefault()});e(".sg-replace-content",j).on("shown.bs.tab",function(m){var l=e(e(this).attr("href"));var k=e(this).attr("data-url");e.get(k,function(n){l.html(n);i(l)});e(this).removeClass("sg-replace-content");e(this).unbind("shown.bs.tab")});e(".sg-data-close",j).click(function(k){e(this).parent().parent().fadeOut("fast",function(){e(this).remove()})});e("input.sg-fileupload",j).fileinput({showUpload:false});e("input.sg-fileupload-small",j).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});e(".sg-pictogram-modal").on("shown.bs.modal",function(){var n=e(this);var m=n.attr("id");var l=e("#container-"+m,n);var k=e("#filter-"+m,n);k.on("input propertychange paste",function(){g(n,l,m,j,e(this).val())}).onEnter(function(){var p=e(".sg-pictogram-modal-link",l).first();if(p.length>0){var r=p.attr("data-id");var q=p.attr("data-id");var o=e("<div/>").text(p.attr("title")).html();e("#value-"+m,j).val(r);e("#preview-"+m,j).html('<img src="'+urlSegradaPictogramFile+q+'" width="24" height="24" alt="'+o+'" /> '+o);e("#clear-"+m,j).show();n.modal("hide")}});if(k.val()===""){g(n,l,m,j,"")}});e(".sg-pictogram-chooser",j).click(function(k){e("#"+e(this).attr("data-id")).modal("show");k.preventDefault()});e(".sg-pictogram-clearer",j).click(function(l){var k=e(this).attr("data-id");e("#value-"+k,j).val("");e("#preview-"+k,j).html("");e(this).hide();l.preventDefault()});e(".sg-source-ref-modal").on("shown.bs.modal",function(){var m=e(this);var l=m.attr("id");var k=e(".modal-body",m);e.get(m.attr("data-href"),function(n){k.html(n);e("form",k).ajaxForm({beforeSubmit:function(o,p,q){p.wrapInner("<div class='sg-disabled'></div>");p.prepend(e("#sg-wait").html());return true},success:function(p,r,s,o){var q=e(m.attr("data-target"));q.html(p);i(q);m.modal("hide")}})})}).on("hidden.bs.modal",function(){e(".modal-body",e(this)).html(e("#sg-wait").html())});e(".sg-source-ref-editor",j).click(function(l){var k=e("#"+e(this).attr("data-id"));k.attr("data-href",e(this).attr("href"));k.modal("show");l.preventDefault()});e(".sg-taglist-contract",j).each(function(){var k=e("span",e(this));if(k.length>1){k.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');e("span.sg-tag-show",e(this)).click(function(){e(this).remove();k.show()})}});e("select.sg-colorpicker",j).simplepicker({theme:"fontawesome"});e("select.sg-tags",j).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:f.ttAdapter()}});e("input.sg-node-search",j).each(function(){var l=e(this);var k=e("#"+l.attr("data-id"));l.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:a.ttAdapter()}).bind("typeahead:selected",function(n,m){k.val(m.id)}).bind("keyup",function(){if(!this.value){k.val("")}})});e("input.sg-file-search",j).each(function(){var l=e(this);var k=e("#"+l.attr("data-id"));l.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:c.ttAdapter()}).bind("typeahead:selected",function(n,m){k.val(m.id)}).bind("keyup",function(){if(!this.value){k.val("")}})});e("input.sg-source-search",j).each(function(){var l=e(this);var k=e("#"+l.attr("data-id"));l.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:d.ttAdapter()}).bind("typeahead:selected",function(n,m){k.val(m.id)}).bind("keyup",function(){if(!this.value){k.val("")}})});e(".sg-link-external").click(function(m){var k=e(this).attr("href");var l=window.open(k,"_blank");l.focus();m.preventDefault()});e("form.sg-data-form",j).ajaxForm({beforeSubmit:function(k,l,m){e(":input",l).attr("disabled",true);return true},success:function(m,o,p,k){var n=k.attr("data-id");if(typeof n!=="undefined"){n=e("#"+n)}n=n||k;n.replaceWith(m);var l=m.match(b);if(l!=null&&l.length>=2){i(e("#"+l[2]))}}});e(".sg-geotab",j).on("shown.bs.tab",function(o){var n=e(o.target);var p=n.attr("data-map-id");var m=new ol.Map({target:p,layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"})})],view:new ol.View({center:ol.proj.fromLonLat([0,0]),zoom:1,maxZoom:10}),controls:ol.control.defaults({attributionOptions:{collapsible:false}})});var l=new ol.source.Vector({features:[]});var k=new ol.layer.Vector({source:l});m.addLayer(k);e("#"+p+"-content div").each(function(){var r=parseFloat(e(this).attr("data-lng"));var s=parseFloat(e(this).attr("data-lat"));var q=h(ol.proj.transform([r,s],"EPSG:4326","EPSG:3857"),mapIconStyle);l.addFeature(q)})})}e(document).ready(function(){e("#sg-close-all").click(function(j){e(".sg-data").fadeOut("fast",function(){e(this).remove()});j.preventDefault()});e(".sg-locale").click(function(j){e.get(e(this).attr("href"),function(l){var k=e("#sg-base").html();if(l!=""){window.location.href=k}});j.preventDefault()});f.initialize();i(e("body"))});function h(j,k){var l=new ol.Feature({geometry:new ol.geom.Point(j)});l.setStyle(k);return l}mapIconStyle=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"/img/marker-icon.png"}))})})(jQuery);