function escapeHTML(a){if(typeof a=="string"){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return""}(function(c){var g=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var i=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(t,u){var v=t+u;var s=c(".sg-node-search").filter(":focus");var x=c("#"+s.attr("data-select-id")+" option").filter(":selected");var w=x.attr(s.attr("data-attr"));if(w!=null&&w.length>0){v+="&tags="+encodeURIComponent(w)}return v}}});var l=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var r=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});function n(s){return s.replace(/;jsessionid=([^?]*)/,"")}urlSegradaPictogramSearch=n(urlSegradaPictogramSearch);urlSegradaPictogramFile=n(urlSegradaPictogramFile);urlSegradaTagSearch=n(urlSegradaTagSearch);urlSegradaNodeSearch=n(urlSegradaNodeSearch);urlSegradaFileSearch=n(urlSegradaFileSearch);urlSegradaSourceSearch=n(urlSegradaSourceSearch);urlSegradaRelationAdd=n(urlSegradaRelationAdd);var h=false;var e=new vis.DataSet([]);var p=new vis.DataSet([]);var a=null;c.fn.onEnter=function(s){this.bind("keypress",function(t){if(t.keyCode==13){s.apply(this,[t])}});return this};var j=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function d(x,w,v,s,u){var t=urlSegradaPictogramSearch+encodeURIComponent(u);c.getJSON(t,function(z){var y=[];c.each(z,function(A,B){var C=c("<div/>").text(B.title).html();y.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+B.id+'" data-uid="'+B.uid+'" title="'+C+'"><img src="'+urlSegradaPictogramFile+B.uid+'" width="24" height="24" alt="'+C+'" /></a></div>')});w.html("<div class='row'>"+y.join("")+"</div>");c("a",w).click(function(D){var C=c(this).attr("data-id");var B=c(this).attr("data-uid");var A=c("<div/>").text(c(this).attr("title")).html();c("#value-"+v,s).val(C);c("#preview-"+v,s).html('<img src="'+urlSegradaPictogramFile+B+'" width="24" height="24" alt="'+A+'" /> '+A);c("#clear-"+v,s).show();D.preventDefault();x.modal("hide")})}).fail(function(){alert("ERROR")})}function k(s){c.get(s,function(w){var v=w.match(j);if(v!=null&&v.length>=2){c("#"+v[2]).remove()}var u=c("#sg-data");u.prepend(w);var t=u.children(":first");m(t);c("html, body").animate({scrollTop:t.offset().top},500)}).fail(function(){alert("ERROR")})}function m(s){s=s||c("body");c(".sg-data").addClass("sg-dynamic-data");c(".sg-headbox-right").show();c(".sg-dynamic-hide").hide();c(".sg-data-add",s).click(function(u){k(c(this).attr("href"));u.preventDefault()});c(".sg-control-form",s).ajaxForm({beforeSubmit:function(u,w,x){var y=w.attr("data-target-id");if(typeof y=="undefined"||y==null||y.length==0){y="#sg-control";f()}var v=c(y);v.wrapInner("<div class='sg-disabled'></div>");v.prepend(c("#sg-wait").html());return true},success:function(w,y,z,v){var x=v.attr("data-target-id");if(typeof x=="undefined"||x==null||x.length==0){x="#sg-control"}var u=c(x);u.html(w);m(u)},error:function(w,y,z,v){var x=v.attr("data-target-id");if(typeof x=="undefined"||x==null||x.length==0){x="#sg-control"}var u=c(x);u.html(w.statusText);alert("Error "+w.status+"\n"+w.statusText)}});c(".sg-submit-form",s).change(function(){c(this).closest("form").submit()});c(".sg-control-set",s).click(function(x){var w=c(this);var v=w.attr("data-target-id");if(typeof v=="undefined"||v==null||v.length==0){v="#sg-control";f()}var u=c(v);u.wrapInner("<div class='sg-disabled'></div>");u.prepend(c("#sg-wait").html());c.get(w.attr("href"),function(y){u.html(y);m(u)}).fail(function(){alert("ERROR")});x.preventDefault()});c("[data-data-dblclick]",s).dblclick(function(){c.get(c(this).attr("data-data-dblclick"),function(x){var w=x.match(j);if(w!=null&&w.length>=2){c("#"+w[2]).remove()}var v=c("#sg-data");v.prepend(x);var u=v.children(":first");m(u);c("html, body").animate({scrollTop:u.offset().top},500)}).fail(function(){alert("ERROR")})});c("tr [data-confirm]",s).click(function(v){var u=c(this);if(confirm(u.attr("data-confirm"))){var w=u.closest("tr");w.addClass("sg-disabled");c.get(u.attr("href"),function(x){w.slideUp("fast",function(){w.remove()})}).fail(function(){alert("ERROR")})}v.preventDefault()});c(".sg-replace-content",s).on("shown.bs.tab",function(w){var v=c(c(this).attr("href"));var u=c(this).attr("data-url");c.get(u,function(x){v.html(x);m(v)}).fail(function(){alert("ERROR")});c(this).removeClass("sg-replace-content");c(this).unbind("shown.bs.tab")});c(".sg-data-close",s).click(function(u){c(this).parent().parent().fadeOut("fast",function(){c(this).remove()})});c("input.sg-fileupload",s).fileinput({showUpload:false});c("input.sg-fileupload-small",s).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});c(".sg-pictogram-modal").on("shown.bs.modal",function(){var x=c(this);var w=x.attr("id");var v=c("#container-"+w,x);var u=c("#filter-"+w,x);u.on("input propertychange paste",function(){d(x,v,w,s,c(this).val())}).onEnter(function(){var z=c(".sg-pictogram-modal-link",v).first();if(z.length>0){var B=z.attr("data-id");var A=z.attr("data-id");var y=c("<div/>").text(z.attr("title")).html();c("#value-"+w,s).val(B);c("#preview-"+w,s).html('<img src="'+urlSegradaPictogramFile+A+'" width="24" height="24" alt="'+y+'" /> '+y);c("#clear-"+w,s).show();x.modal("hide")}});if(u.val()===""){d(x,v,w,s,"")}});c(".sg-pictogram-chooser",s).click(function(u){c("#"+c(this).attr("data-id")).modal("show");u.preventDefault()});c(".sg-pictogram-clearer",s).click(function(v){var u=c(this).attr("data-id");c("#value-"+u,s).val("");c("#preview-"+u,s).html("");c(this).hide();v.preventDefault()});c(".sg-source-ref-modal").on("shown.bs.modal",function(){var w=c(this);var v=w.attr("id");var u=c(".modal-body",w);c.get(w.attr("data-href"),function(x){u.html(x);c("form",u).ajaxForm({beforeSubmit:function(y,z,A){z.wrapInner("<div class='sg-disabled'></div>");z.prepend(c("#sg-wait").html());return true},success:function(z,B,C,y){var A=c(w.attr("data-target"));A.html(z);m(A);w.modal("hide")},error:function(z,A,B,y){alert("Error "+z.status+"\n"+z.statusText)}})}).fail(function(){alert("ERROR")})}).on("hidden.bs.modal",function(){c(".modal-body",c(this)).html(c("#sg-wait").html())});c(".sg-source-ref-editor",s).click(function(v){var u=c("#"+c(this).attr("data-id"));u.attr("data-href",c(this).attr("href"));u.modal("show");v.preventDefault()});c(".sg-taglist-contract",s).each(function(){var u=c("span",c(this));if(u.length>1){u.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');c("span.sg-tag-show",c(this)).click(function(){c(this).remove();u.show()})}});c("select.sg-colorpicker",s).simplepicker({theme:"fontawesome"});c("select.sg-tags",s).each(function(){var u=c(this);u.tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:g.ttAdapter()}});u.on("itemRemoved",function(v){u.find('option[value="'+v.item+'"]').remove()})});c("input.sg-node-search",s).each(function(){var v=c(this);var u=c("#"+v.attr("data-id"));v.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:i.ttAdapter()}).bind("typeahead:selected",function(x,w){u.val(w.id)}).bind("keyup",function(){if(!this.value){u.val("")}})});c("input.sg-file-search",s).each(function(){var v=c(this);var u=c("#"+v.attr("data-id"));v.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:l.ttAdapter()}).bind("typeahead:selected",function(x,w){u.val(w.id)}).bind("keyup",function(){if(!this.value){u.val("")}})});c("input.sg-source-search",s).each(function(){var v=c(this);var u=c("#"+v.attr("data-id"));v.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:r.ttAdapter()}).bind("typeahead:selected",function(x,w){u.val(w.id)}).bind("keyup",function(){if(!this.value){u.val("")}})});c(".sg-link-external",s).click(function(w){var u=c(this).attr("href");var v=window.open(u,"_blank");v.focus();w.preventDefault()});c("form.sg-data-form",s).ajaxForm({beforeSubmit:function(u,v,w){c(":input",v).attr("disabled",true);return true},success:function(w,y,z,u){var x=u.attr("data-id");if(typeof x!=="undefined"){x=c("#"+x)}x=x||u;x.replaceWith(w);var v=w.match(j);if(v!=null&&v.length>=2){m(c("#"+v[2]))}},error:function(v,w,x,u){c(":input",u).attr("disabled",false);alert("Error "+v.status+"\n"+v.statusText)}});c("form.sg-simple-form",s).ajaxForm({beforeSubmit:function(u,v,w){c(":input",v).attr("disabled",true);var x=v.attr("data-id");if(typeof x!=="undefined"){x=c("#"+x)}x=x||v;x.html(c("#sg-wait"));return true},success:function(v,x,y,u){var w=u.attr("data-id");if(typeof w!=="undefined"){w=c("#"+w)}w=w||u;w.html(v);c(":input",u).attr("disabled",false)},error:function(v,w,x,u){c(":input",u).attr("disabled",false);alert("Error "+v.status+"\n"+v.statusText)}});c(".sg-periods").each(function(){var u=c(this);var w=u.attr("id");var v=c(".sg-period-form",u);c(".sg-period-add",u).click(function(y){c(this).hide();var x=c(".sg-period-form-add",u);x.show();c(".sg-period-form-period",x).change(function(z){if(c(this).is(":checked")){c(".sg-period-toggle",x).show()}else{c(".sg-period-toggle",x).hide()}});y.preventDefault()});c(".sg-period-edit",u).click(function(x){c(this).hide();c(".sg-period-form-edit",u).show();x.preventDefault()});v.ajaxForm({beforeSubmit:function(x,y,z){u.addClass("disabled");return true},success:function(y,z,A,x){u.replaceWith(y);m(c("#"+w))},error:function(y,z,A,x){u.removeClass("disabled");alert("Error "+y.status+"\n"+y.statusText)}})});c("a.sg-graph-update",s).click(function(u){q(c(this).attr("href"));u.preventDefault()});c("div.sg-tag-hierarchy",s).each(function(){var z=c(this);var u=c(".sg-tag-hierarchy-graph",z);c(".sg-child-tags",z).hide();u.addClass("sg-margin-top sg-margin-bottom");var A=c(".sg-tag-hierarchy-data",z);var w=A.attr("data-center");var D=0;var C=0;var v=[];var y=[];c("div",A).each(function(){var I=c(this);var G=I.attr("data-id");var H=I.attr("data-level");v.push({id:G,label:I.html(),level:H,url:I.attr("data-url")});if(H=="0"){y.push({from:G,to:w});D++}else{if(H=="2"){y.push({from:w,to:G});C++}}});var B=D>C?(D==0?1:D):C;u.css({width:"100%",height:(B*50)+"px",border:"1px solid #ccc"});var x={nodes:new vis.DataSet(v),edges:new vis.DataSet(y)};v=null;y=null;var F={edges:{smooth:{type:"cubicBezier",forceDirection:"horizontal",roundness:0.6}},nodes:{shape:"box"},layout:{hierarchical:{direction:"LR"}}};var E=new vis.Network(u.get(0),x,F);E.on("doubleClick",function(I){var G=null;if(I.nodes.length>0){var H=x.nodes.get(I.nodes[0]);if(H!=null&&H.url!=null){G=H.url}}if(G!=null){k(G)}})});for(var t=0;t<afterAjaxHooks.length;t++){afterAjaxHooks[t](s)}}function b(){if(!h){h=true;var s=document.getElementById("sg-graph");var u={nodes:e,edges:p};var t={locale:c("html").attr("lang"),locales:{de:{edit:"Änderungsmodus",del:"Lösche Auswahl",back:"Zurück",addNode:"Knoten hinzufügen",addEdge:"Verknüpfung hinzufügen",editNode:"Knoten editieren",editEdge:"Verknüpfung editieren",addDescription:"Klicke auf eine freie Stelle, um einen neuen Knoten zu plazieren.",edgeDescription:"Klicke auf einen Knoten und ziehe die Verknüpfung zu einem anderen Knoten, um diese zu verbinden.",editEdgeDescription:"Klicke auf die Verbindungspunkte und ziehe diese auf einen Knoten, um sie zu verbinden.",createEdgeError:"Es ist nicht möglich, Verknüpfungen mit Clustern zu verbinden.",deleteClusterError:"Cluster können nicht gelöscht werden.",editClusterError:"Cluster können nicht editiert werden."},en:{edit:"Toggle edit",del:"Delete selected",back:"Back",addNode:"Add Node",addEdge:"Add Relation",editNode:"Edit Node",editEdge:"Edit Relation",addDescription:"Click in an empty space to place a new node.",edgeDescription:"Click on a node and drag the relation to another node to connect them.",editEdgeDescription:"Click on the control points and drag them to a node to connect to it.",createEdgeError:"Cannot link relations to a cluster.",deleteClusterError:"Clusters cannot be deleted.",editClusterError:"Clusters cannot be edited."}},manipulation:{enabled:true,addNode:false,addEdge:function(w,x){var v=urlSegradaRelationAdd.replace("XFROMX",w.from.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("XTOX",w.to.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("&amp;","&");k(v);return false},editNode:function(v,w){return false},editEdge:function(v,w){return false},deleteNode:function(v,w){return false},deleteEdge:function(v,w){return false}},nodes:{shape:"icon",color:{border:"#000",background:"#fff"}},edges:{font:{size:10},labelHighlightBold:false,selectionWidth:0,arrows:{to:true},smooth:{type:"cubicBezier"}},groups:{node:{icon:{code:"\uf192",color:"#000000"}},tag:{shape:"box",color:{border:"#5bc0de",background:"#5bc0de",highlight:{background:"#2B7CE9"}},font:{color:"#ffffff",size:12}}},physics:{barnesHut:{springLength:120}}};a=new vis.Network(s,u,t);a.on("doubleClick",function(y){var v=null;if(y.nodes.length>0){var x=e.get(y.nodes[0]);if(x!=null&&x.url!=null){v=x.url}}else{if(y.edges.length>0){var w=p.get(y.edges[0]);if(w!=null&&w.url!=null){v=w.url}}}if(v!=null){k(v)}})}}function f(){var s=c("#sg-toggle-graph");if(s.hasClass("active")){s.removeClass("active");c(".fa-share-alt-square",s).addClass("fa-share-alt").removeClass("fa-share-alt-square");c("#sg-graph-container").hide();c("#sg-control").show();a.destroy();h=false}}function o(){var s=c("#sg-toggle-graph");if(!s.hasClass("active")){s.addClass("active");c(".fa-share-alt",s).addClass("fa-share-alt-square").removeClass("fa-share-alt");c("#sg-control").hide();c("#sg-graph-container").show();b()}}function q(t){if(t==null){alert("Null url!");return}o();var v=[];var x=[];var s=e.get({fields:["id"]});for(var u=0;u<s.length;u++){v.push(s[u].id)}s=p.get({fields:["id"]});for(var u=0;u<s.length;u++){x.push(s[u].id)}var w=c("#sg-graph-container").attr("data-csrf");c.ajax({url:t,type:"POST",dataType:"json",headers:{"Content-Type":"application/json","X-CSRF-Token":w},data:JSON.stringify({nodes:v,edges:x}),success:function(z,A,y){if(z==null){alert("NULL data");return}if(z.error!=null){alert(z.error);return}if(z.nodes!=null&&z.nodes.length>0){e.update(z.nodes)}if(z.edges!=null&&z.edges.length>0){p.update(z.edges)}if(z.removeNodes!=null&&z.removeNodes.length>0){e.remove(z.removeNodes)}if(z.removeEdges!=null&&z.removeEdges.length>0){p.remove(z.removeEdges)}if(z.highlightNode!=null){a.unselectAll();a.selectNodes([z.highlightNode],false)}a.fit()}})}c.event.special.destroyed={remove:function(s){if(s.handler){s.handler()}}};c(document).ready(function(){c("#sg-close-all").click(function(s){c(".sg-data").fadeOut("fast",function(){c(this).remove()});s.preventDefault()});c(".sg-locale").click(function(s){c.get(c(this).attr("href"),function(u){var t=c("#sg-base").html();if(u!=""){window.location.href=t}}).fail(function(){alert("ERROR")});s.preventDefault()});g.initialize();c("#sg-toggle-graph").click(function(s){if(c(this).hasClass("active")){f()}else{o()}s.preventDefault()});c("#sg-graph-action-remove").click(function(t){var s=a.getSelection();if(s.edges.length>0){p.remove(s.edges)}if(s.nodes.length>0){e.remove(s.nodes)}t.preventDefault()});c("#sg-graph-action-restart").click(function(s){p.clear();e.clear();s.preventDefault()});c("#sg-graph-action-reload").click(function(s){a.destroy();h=false;b();s.preventDefault()});c("#sg-graph-action-fit").click(function(s){a.fit();s.preventDefault()});c("#sg-graph-close").click(function(s){f();s.preventDefault()});m(c("body"))})})(jQuery);