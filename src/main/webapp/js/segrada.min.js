(function(c){function n(v){if(typeof v=="string"){return v.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return""}var g=new Bloodhound({datumTokenizer:function(v){return Bloodhound.tokenizers.whitespace(v.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var i=new Bloodhound({datumTokenizer:function(v){return Bloodhound.tokenizers.whitespace(v.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(w,x){var y=w+x;var v=c(".sg-node-search").filter(":focus");var A=c("#"+v.attr("data-select-id")+" option").filter(":selected");var z=A.attr(v.attr("data-attr"));if(z!=null&&z.length>0){y+="&tags="+encodeURIComponent(z)}return y}}});var l=new Bloodhound({datumTokenizer:function(v){return Bloodhound.tokenizers.whitespace(v.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var u=new Bloodhound({datumTokenizer:function(v){return Bloodhound.tokenizers.whitespace(v.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});var o=false;window.gMapsCallback=function(){o=true};window.loadGoogleMaps=function(){if(o){return window.gMapsCallback()}var v=document.createElement("script");v.setAttribute("type","text/javascript");v.setAttribute("src","http://maps.google.com/maps/api/js?sensor=false&callback=gMapsCallback&libraries=places&language="+c("html").attr("lang"));(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(v)};var h=false;var e=new vis.DataSet([]);var r=new vis.DataSet([]);var a=null;c.fn.onEnter=function(v){this.bind("keypress",function(w){if(w.keyCode==13){v.apply(this,[w])}});return this};var j=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function d(A,z,y,v,x){var w=urlSegradaPictogramSearch+encodeURIComponent(x);c.getJSON(w,function(C){var B=[];c.each(C,function(D,E){var F=c("<div/>").text(E.title).html();B.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+E.id+'" data-uid="'+E.uid+'" title="'+F+'"><img src="'+urlSegradaPictogramFile+E.uid+'" width="24" height="24" alt="'+F+'" /></a></div>')});z.html("<div class='row'>"+B.join("")+"</div>");c("a",z).click(function(G){var F=c(this).attr("data-id");var E=c(this).attr("data-uid");var D=c("<div/>").text(c(this).attr("title")).html();c("#value-"+y,v).val(F);c("#preview-"+y,v).html('<img src="'+urlSegradaPictogramFile+E+'" width="24" height="24" alt="'+D+'" /> '+D);c("#clear-"+y,v).show();G.preventDefault();A.modal("hide")})})}function k(v){c.get(v,function(z){var y=z.match(j);if(y!=null&&y.length>=2){c("#"+y[2]).remove()}var x=c("#sg-data");x.prepend(z);var w=x.children(":first");m(w);c("html, body").animate({scrollTop:w.offset().top},500)})}function m(v){v=v||c("body");c(".sg-data").addClass("sg-dynamic-data");c(".sg-headbox-right").show();c(".sg-dynamic-hide").hide();c(".sg-data-add",v).click(function(w){k(c(this).attr("href"));w.preventDefault()});c(".sg-control-form",v).ajaxForm({beforeSubmit:function(w,y,z){var A=y.attr("data-target-id");if(typeof A=="undefined"||A==null||A.length==0){A="#sg-control";f()}var x=c(A);x.wrapInner("<div class='sg-disabled'></div>");x.prepend(c("#sg-wait").html());return true},success:function(y,A,B,x){var z=x.attr("data-target-id");if(typeof z=="undefined"||z==null||z.length==0){z="#sg-control"}var w=c(z);w.html(y);m(w)}});c(".sg-control-set",v).click(function(z){var y=c(this);var x=y.attr("data-target-id");if(typeof x=="undefined"||x==null||x.length==0){x="#sg-control";f()}var w=c(x);w.wrapInner("<div class='sg-disabled'></div>");w.prepend(c("#sg-wait").html());c.get(y.attr("href"),function(A){w.html(A);m(w)});z.preventDefault()});c("[data-data-dblclick]",v).dblclick(function(){c.get(c(this).attr("data-data-dblclick"),function(z){var y=z.match(j);if(y!=null&&y.length>=2){c("#"+y[2]).remove()}var x=c("#sg-data");x.prepend(z);var w=x.children(":first");m(w);c("html, body").animate({scrollTop:w.offset().top},500)})});c("tr [data-confirm]",v).click(function(x){var w=c(this);if(confirm(w.attr("data-confirm"))){var y=w.closest("tr");y.addClass("sg-disabled");c.get(w.attr("href"),function(z){y.slideUp("fast",function(){y.remove()})})}x.preventDefault()});c(".sg-replace-content",v).on("shown.bs.tab",function(y){var x=c(c(this).attr("href"));var w=c(this).attr("data-url");c.get(w,function(z){x.html(z);m(x)});c(this).removeClass("sg-replace-content");c(this).unbind("shown.bs.tab")});c(".sg-data-close",v).click(function(w){c(this).parent().parent().fadeOut("fast",function(){c(this).remove()})});c("input.sg-fileupload",v).fileinput({showUpload:false});c("input.sg-fileupload-small",v).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});c(".sg-pictogram-modal").on("shown.bs.modal",function(){var z=c(this);var y=z.attr("id");var x=c("#container-"+y,z);var w=c("#filter-"+y,z);w.on("input propertychange paste",function(){d(z,x,y,v,c(this).val())}).onEnter(function(){var B=c(".sg-pictogram-modal-link",x).first();if(B.length>0){var D=B.attr("data-id");var C=B.attr("data-id");var A=c("<div/>").text(B.attr("title")).html();c("#value-"+y,v).val(D);c("#preview-"+y,v).html('<img src="'+urlSegradaPictogramFile+C+'" width="24" height="24" alt="'+A+'" /> '+A);c("#clear-"+y,v).show();z.modal("hide")}});if(w.val()===""){d(z,x,y,v,"")}});c(".sg-pictogram-chooser",v).click(function(w){c("#"+c(this).attr("data-id")).modal("show");w.preventDefault()});c(".sg-pictogram-clearer",v).click(function(x){var w=c(this).attr("data-id");c("#value-"+w,v).val("");c("#preview-"+w,v).html("");c(this).hide();x.preventDefault()});c(".sg-source-ref-modal").on("shown.bs.modal",function(){var y=c(this);var x=y.attr("id");var w=c(".modal-body",y);c.get(y.attr("data-href"),function(z){w.html(z);c("form",w).ajaxForm({beforeSubmit:function(A,B,C){B.wrapInner("<div class='sg-disabled'></div>");B.prepend(c("#sg-wait").html());return true},success:function(B,D,E,A){var C=c(y.attr("data-target"));C.html(B);m(C);y.modal("hide")}})})}).on("hidden.bs.modal",function(){c(".modal-body",c(this)).html(c("#sg-wait").html())});c(".sg-source-ref-editor",v).click(function(x){var w=c("#"+c(this).attr("data-id"));w.attr("data-href",c(this).attr("href"));w.modal("show");x.preventDefault()});c(".sg-taglist-contract",v).each(function(){var w=c("span",c(this));if(w.length>1){w.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');c("span.sg-tag-show",c(this)).click(function(){c(this).remove();w.show()})}});c("select.sg-colorpicker",v).simplepicker({theme:"fontawesome"});c("select.sg-tags",v).each(function(){var w=c(this);w.tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:g.ttAdapter()}});w.on("itemRemoved",function(x){w.find('option[value="'+x.item+'"]').remove()})});c("input.sg-node-search",v).each(function(){var x=c(this);var w=c("#"+x.attr("data-id"));x.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:i.ttAdapter()}).bind("typeahead:selected",function(z,y){w.val(y.id)}).bind("keyup",function(){if(!this.value){w.val("")}})});c("input.sg-file-search",v).each(function(){var x=c(this);var w=c("#"+x.attr("data-id"));x.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:l.ttAdapter()}).bind("typeahead:selected",function(z,y){w.val(y.id)}).bind("keyup",function(){if(!this.value){w.val("")}})});c("input.sg-source-search",v).each(function(){var x=c(this);var w=c("#"+x.attr("data-id"));x.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:u.ttAdapter()}).bind("typeahead:selected",function(z,y){w.val(y.id)}).bind("keyup",function(){if(!this.value){w.val("")}})});c(".sg-link-external",v).click(function(y){var w=c(this).attr("href");var x=window.open(w,"_blank");x.focus();y.preventDefault()});c("form.sg-data-form",v).ajaxForm({beforeSubmit:function(w,x,y){c(":input",x).attr("disabled",true);return true},success:function(y,A,B,w){var z=w.attr("data-id");if(typeof z!=="undefined"){z=c("#"+z)}z=z||w;z.replaceWith(y);var x=y.match(j);if(x!=null&&x.length>=2){m(c("#"+x[2]))}}});c("form.sg-simple-form",v).ajaxForm({beforeSubmit:function(w,x,y){c(":input",x).attr("disabled",true);var z=x.attr("data-id");if(typeof z!=="undefined"){z=c("#"+z)}z=z||x;z.html(c("#sg-wait"));return true},success:function(x,z,A,w){var y=w.attr("data-id");if(typeof y!=="undefined"){y=c("#"+y)}y=y||w;y.html(x);c(":input",w).attr("disabled",false)}});c(".sg-periods").each(function(){var w=c(this);var y=w.attr("id");var x=c(".sg-period-form",w);c(".sg-period-add",w).click(function(z){c(this).hide();x.show();z.preventDefault()});c(".sg-period-form-period",w).change(function(z){if(c(this).is(":checked")){c(".sg-period-toggle",w).show()}else{c(".sg-period-toggle",w).hide()}});x.ajaxForm({beforeSubmit:function(z,A,B){w.addClass("disabled");return true},success:function(A,B,C,z){w.replaceWith(A);m(w)}})});c(".sg-geotab",v).on("shown.bs.tab",function(B){var A=c(B.target);if(A.attr("data-created")=="1"){return}A.attr("data-created","1");var C=A.attr("data-locations-id");var x=c(C);var z=c(".sg-map-form",x);var y=c(".sg-geocomplete",z);var w=new google.maps.LatLng(0,0);y.geocomplete({map:C+"-map",details:C+"-form",markerOptions:{draggable:true},mapOptions:{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:1,center:w,scrollwheel:true,draggable:true}}).bind("geocode:result",function(E,D){c("input[type=submit]",z).show()}).bind("geocode:dragged",function(E,D){c("input[name=lat]",z).val(D.lat());c("input[name=lng]",z).val(D.lng())});c(".sg-map-add-marker",x).click(function(D){c(this).hide();z.show();D.preventDefault()});s(C,c(C+"-markers",x),y);c(C+"-map").on("destroyed",function(){if(typeof p[C]!=="undefined"){for(var D=0;D<p[C].length;D++){p[C][D].setMap(null)}delete p[C]}});c(".sg-geocomplete-find",z).click(function(){y.trigger("geocode")}).click();z.ajaxForm({beforeSubmit:function(D,E,F){x.addClass("disabled");return true},success:function(E,F,G,D){x.removeClass("disabled");c(C+"-markers",x).replaceWith(E);s(C,c(C+"-markers",x),y)}})});c("a.sg-graph-update",v).click(function(w){t(c(this).attr("href"));w.preventDefault()});c("div.sg-tag-hierarchy",v).each(function(){var B=c(this);var w=c(".sg-tag-hierarchy-graph",B);c(".sg-child-tags",B).hide();w.addClass("sg-margin-top sg-margin-bottom");var C=c(".sg-tag-hierarchy-data",B);var y=C.attr("data-center");var F=0;var E=0;var x=[];var A=[];c("div",C).each(function(){var K=c(this);var I=K.attr("data-id");var J=K.attr("data-level");x.push({id:I,label:K.html(),level:J,url:K.attr("data-url")});if(J=="0"){A.push({from:I,to:y});F++}else{if(J=="2"){A.push({from:y,to:I});E++}}});var D=F>E?(F==0?1:F):E;w.css({width:"100%",height:(D*50)+"px",border:"1px solid #ccc"});var z={nodes:new vis.DataSet(x),edges:new vis.DataSet(A)};x=null;A=null;var H={edges:{smooth:{type:"cubicBezier",forceDirection:"horizontal",roundness:0.6}},nodes:{shape:"box"},layout:{hierarchical:{direction:"LR"}}};var G=new vis.Network(w.get(0),z,H);G.on("doubleClick",function(K){var I=null;if(K.nodes.length>0){var J=z.nodes.get(K.nodes[0]);if(J!=null&&J.url!=null){I=J.url}}if(I!=null){k(I)}})})}var p=[];function s(B,w,v){var A=v.geocomplete("map");if(typeof p[B]!=="undefined"){for(var x=0;x<p[B].length;x++){p[B][x].setMap(null)}delete p[B]}p[B]=[];var z=c(B+"-delete").html();var y=new google.maps.LatLngBounds();c(".sg-location-marker",w).each(function(){var G=c(this);var D=new google.maps.LatLng(G.attr("data-lat"),G.attr("data-lng"));y.extend(D);var E=G.attr("data-id");var H=G.attr("data-comment");if(typeof H!="undefined"&&H!=""){H="<p>"+n(H)+"</p>"}else{H=""}var F=new google.maps.InfoWindow({content:"<p>"+G.attr("data-lat")+","+G.attr("data-lng")+"</p>"+H+'<p><a href="'+G.attr("data-delete")+'" id="'+E+'-delete">'+z+"</a></p>"});var C=new google.maps.Marker({position:D,map:A,icon:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"});google.maps.event.addListener(C,"click",function(){F.open(A,C);var I=c("#"+E+"-delete");I.unbind("click");I.click(function(J){var K=c(B+"-delete-confirm").html().replace("{0}",G.attr("data-lat")+","+G.attr("data-lng"));if(confirm(K)){c.get(c(this).attr("href"),function(L){w.replaceWith(L);s(B,c(B+"-markers"),v)})}J.preventDefault()})});p[B][p[B].length]=C});if(p[B].length==0){A.setZoom(1);A.setCenter(new google.maps.LatLng(0,0))}else{A.fitBounds(y);if(p[B].length==1){setTimeout(function(){A.setZoom(12)},250)}}}function b(){if(!h){h=true;var v=document.getElementById("sg-graph");var x={nodes:e,edges:r};var w={locale:c("html").attr("lang"),locales:{de:{edit:"Änderungsmodus",del:"Lösche Auswahl",back:"Zurück",addNode:"Knoten hinzufügen",addEdge:"Verknüpfung hinzufügen",editNode:"Knoten editieren",editEdge:"Verknüpfung editieren",addDescription:"Klicke auf eine freie Stelle, um einen neuen Knoten zu plazieren.",edgeDescription:"Klicke auf einen Knoten und ziehe die Verknüpfung zu einem anderen Knoten, um diese zu verbinden.",editEdgeDescription:"Klicke auf die Verbindungspunkte und ziehe diese auf einen Knoten, um sie zu verbinden.",createEdgeError:"Es ist nicht möglich, Verknüpfungen mit Clustern zu verbinden.",deleteClusterError:"Cluster können nicht gelöscht werden.",editClusterError:"Cluster können nicht editiert werden."},en:{edit:"Toggle edit",del:"Delete selected",back:"Back",addNode:"Add Node",addEdge:"Add Relation",editNode:"Edit Node",editEdge:"Edit Relation",addDescription:"Click in an empty space to place a new node.",edgeDescription:"Click on a node and drag the relation to another node to connect them.",editEdgeDescription:"Click on the control points and drag them to a node to connect to it.",createEdgeError:"Cannot link relations to a cluster.",deleteClusterError:"Clusters cannot be deleted.",editClusterError:"Clusters cannot be edited."}},manipulation:{enabled:true,addNode:false,addEdge:function(z,A){var y=urlSegradaRelationAdd.replace("XFROMX",z.from.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("XTOX",z.to.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("&amp;","&");k(y);return false},editNode:false,editEdge:false,deleteNode:false,deleteEdge:false},nodes:{shape:"icon",color:{border:"#000",background:"#fff"}},edges:{font:{size:10},labelHighlightBold:false,selectionWidth:0,arrows:{to:true},smooth:{type:"cubicBezier"}},groups:{node:{icon:{code:"\uf192",color:"#000000"}}},physics:{barnesHut:{springLength:120}}};a=new vis.Network(v,x,w);a.on("doubleClick",function(B){var y=null;if(B.nodes.length>0){var A=e.get(B.nodes[0]);if(A!=null&&A.url!=null){y=A.url}}else{if(B.edges.length>0){var z=r.get(B.edges[0]);if(z!=null&&z.url!=null){y=z.url}}}if(y!=null){k(y)}})}}function f(){var v=c("#sg-toggle-graph");if(v.hasClass("active")){v.removeClass("active");c(".fa-share-alt-square",v).addClass("fa-share-alt").removeClass("fa-share-alt-square");c("#sg-graph-container").hide();c("#sg-control").show();a.destroy();h=false}}function q(){var v=c("#sg-toggle-graph");if(!v.hasClass("active")){v.addClass("active");c(".fa-share-alt",v).addClass("fa-share-alt-square").removeClass("fa-share-alt");c("#sg-control").hide();c("#sg-graph-container").show();b()}}function t(w){if(w==null){alert("Null url!");return}q();var y=[];var z=[];var v=e.get({fields:["id"]});for(var x=0;x<v.length;x++){y.push(v[x].id)}v=r.get({fields:["id"]});for(var x=0;x<v.length;x++){z.push(v[x].id)}c.ajax({url:w,type:"POST",dataType:"json",data:JSON.stringify({nodes:y,edges:z}),success:function(B,C,A){if(B==null){alert("NULL data");return}if(B.error!=null){alert(B.error);return}if(B.nodes!=null&&B.nodes.length>0){e.update(B.nodes)}if(B.edges!=null&&B.edges.length>0){r.update(B.edges)}if(B.removeNodes!=null&&B.removeNodes.length>0){e.remove(B.removeNodes)}if(B.removeEdges!=null&&B.removeEdges.length>0){r.remove(B.removeEdges)}if(B.highlightNode!=null){a.unselectAll();a.selectNodes([B.highlightNode],false)}a.fit()}})}c.event.special.destroyed={remove:function(v){if(v.handler){v.handler()}}};c(document).ready(function(){c("#sg-close-all").click(function(v){c(".sg-data").fadeOut("fast",function(){c(this).remove()});v.preventDefault()});c(".sg-locale").click(function(v){c.get(c(this).attr("href"),function(x){var w=c("#sg-base").html();if(x!=""){window.location.href=w}});v.preventDefault()});g.initialize();c("#sg-toggle-graph").click(function(v){if(c(this).hasClass("active")){f()}else{q()}v.preventDefault()});c("#sg-graph-action-remove").click(function(w){var v=a.getSelection();if(v.edges.length>0){r.remove(v.edges)}if(v.nodes.length>0){e.remove(v.nodes)}w.preventDefault()});c("#sg-graph-action-restart").click(function(v){r.clear();e.clear();v.preventDefault()});c("#sg-graph-action-reload").click(function(v){a.destroy();h=false;b();v.preventDefault()});c("#sg-graph-action-fit").click(function(v){a.fit();v.preventDefault()});c("#sg-graph-close").click(function(v){f();v.preventDefault()});m(c("body"));window.loadGoogleMaps()})})(jQuery);