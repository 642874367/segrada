(function(d){var b=new Bloodhound({datumTokenizer:function(f){return Bloodhound.tokenizers.whitespace(f.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:urlSegradaTagSearch+"%QUERY"});d.fn.onEnter=function(f){this.bind("keypress",function(g){if(g.keyCode==13){f.apply(this,[g])}});return this};var a=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function c(k,j,i,f,h){var g=urlSegradaPictogramSearch+encodeURIComponent(h);d.getJSON(g,function(m){var l=[];d.each(m,function(n,o){var p=d("<div/>").text(o.title).html();l.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+o.id+'" data-uid="'+o.uid+'" title="'+p+'"><img src="'+urlSegradaPictogramFile+o.uid+'" width="24" height="24" alt="'+p+'" /></a></div>')});j.html("<div class='row'>"+l.join("")+"</div>");d("a",j).click(function(q){var p=d(this).attr("data-id");var o=d(this).attr("data-uid");var n=d("<div/>").text(d(this).attr("title")).html();d("#value-"+i,f).val(p);d("#preview-"+i,f).html('<img src="'+urlSegradaPictogramFile+o+'" width="24" height="24" alt="'+n+'" /> '+n);d("#clear-"+i,f).show();q.preventDefault();k.modal("hide")})})}function e(f){f=f||d("body");d(".sg-data").addClass("sg-dynamic-data");var g=d(".sg-closeable");g.prepend('<div class="sg-headbox-right"><a href="#" type="button" class="close sg-data-close" aria-label="Close"><span aria-hidden="true">&times;</span></a></div>');g.removeClass("sg-closeable");d(".sg-dynamic-hide").hide();d(".sg-data-add",f).click(function(h){d.get(d(this).attr("href"),function(l){var k=l.match(a);if(k!=null&&k.length>=2){d("#"+k[2]).remove()}var j=d("#sg-data");j.prepend(l);var i=j.children(":first");e(i)});h.preventDefault()});d(".sg-control-set",f).click(function(h){d.get(d(this).attr("href"),function(j){var i=d("#sg-control");i.html(j);e(i)});h.preventDefault()});d("[data-data-dblclick]",f).dblclick(function(){d.get(d(this).attr("data-data-dblclick"),function(k){var j=k.match(a);if(j!=null&&j.length>=2){d("#"+j[2]).remove()}var i=d("#sg-data");i.prepend(k);var h=i.children(":first");e(h)})});d("[data-confirm]",f).click(function(h){if(confirm(d(this).attr("data-confirm"))){if(d(this).hasClass("sg-control-confirm")){d.get(d(this).attr("href"),function(j){var i=d("#sg-control");i.html(j);e(i)})}}h.preventDefault()});d(".sg-data-close",f).click(function(h){d(this).parent().parent().fadeOut("fast",function(){d(this).remove()})});d("input.sg-fileupload",f).fileinput({showUpload:false});d("input.sg-fileupload-small",f).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});d(".sg-pictogram-modal").on("shown.bs.modal",function(){var k=d(this);var j=k.attr("id");var i=d("#container-"+j,k);var h=d("#filter-"+j,k);h.on("input propertychange paste",function(){c(k,i,j,f,d(this).val())}).onEnter(function(){var m=d(".sg-pictogram-modal-link",i).first();if(m.length>0){var o=m.attr("data-id");var n=m.attr("data-id");var l=d("<div/>").text(m.attr("title")).html();d("#value-"+j,f).val(o);d("#preview-"+j,f).html('<img src="'+urlSegradaPictogramFile+n+'" width="24" height="24" alt="'+l+'" /> '+l);d("#clear-"+j,f).show();k.modal("hide")}});if(h.val()===""){c(k,i,j,f,"")}});d(".sg-pictogram-chooser",f).click(function(h){d("#"+d(this).attr("data-id")).modal("show");h.preventDefault()});d(".sg-pictogram-clearer",f).click(function(i){var h=d(this).attr("data-id");d("#value-"+h,f).val("");d("#preview-"+h,f).html("");d(this).hide();i.preventDefault()});d("select.sg-colorpicker").simplepicker({theme:"glyphicons"});d("select.sg-tags").tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:b.ttAdapter()}});d("form.sg-data-form",f).ajaxForm({beforeSubmit:function(h,i,j){d(":input",i).attr("disabled",true);return true},success:function(j,l,m,h){var k=h.attr("data-id");if(typeof k!=="undefined"){k=d("#"+k)}k=k||h;k.replaceWith(j);var i=j.match(a);if(i!=null&&i.length>=2){e(d("#"+i[2]))}}})}d(document).ready(function(){d("#sg-close-all").click(function(f){d(".sg-data").fadeOut("fast",function(){d(this).remove()});f.preventDefault()});d(".sg-control-form").ajaxForm({success:function(h,i,j,g){var f=d("#sg-control");f.html(h);e(f)}});b.initialize();e(d("body"))})})(jQuery);