(function(i){var j=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var a=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(o,p){var q=o+p;var n=i(".sg-node-search").filter(":focus");var s=i("#"+n.attr("data-select-id")+" option").filter(":selected");var r=s.attr(n.attr("data-attr"));if(r!=null&&r.length>0){q+="&tags="+encodeURIComponent(r)}return q}}});var c=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var g=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});var h=(typeof google==="object"&&typeof google.maps==="object")?new google.maps.Geocoder():null;i.fn.onEnter=function(n){this.bind("keypress",function(o){if(o.keyCode==13){n.apply(this,[o])}});return this};var b=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function k(s,r,q,n,p){var o=urlSegradaPictogramSearch+encodeURIComponent(p);i.getJSON(o,function(u){var t=[];i.each(u,function(v,w){var x=i("<div/>").text(w.title).html();t.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+w.id+'" data-uid="'+w.uid+'" title="'+x+'"><img src="'+urlSegradaPictogramFile+w.uid+'" width="24" height="24" alt="'+x+'" /></a></div>')});r.html("<div class='row'>"+t.join("")+"</div>");i("a",r).click(function(y){var x=i(this).attr("data-id");var w=i(this).attr("data-uid");var v=i("<div/>").text(i(this).attr("title")).html();i("#value-"+q,n).val(x);i("#preview-"+q,n).html('<img src="'+urlSegradaPictogramFile+w+'" width="24" height="24" alt="'+v+'" /> '+v);i("#clear-"+q,n).show();y.preventDefault();s.modal("hide")})})}function l(n){n=n||i("body");i(".sg-data").addClass("sg-dynamic-data");i(".sg-headbox-right").show();i(".sg-dynamic-hide").hide();i(".sg-data-add",n).click(function(o){i.get(i(this).attr("href"),function(s){var r=s.match(b);if(r!=null&&r.length>=2){i("#"+r[2]).remove()}var q=i("#sg-data");q.prepend(s);var p=q.children(":first");l(p);i("html, body").animate({scrollTop:p.offset().top},500)});o.preventDefault()});i(".sg-control-form",n).ajaxForm({beforeSubmit:function(o,q,r){var s=q.attr("data-target-id");if(typeof s=="undefined"||s==null||s.length==0){s="#sg-control"}var p=i(s);p.wrapInner("<div class='sg-disabled'></div>");p.prepend(i("#sg-wait").html());return true},success:function(q,s,t,p){var r=p.attr("data-target-id");if(typeof r=="undefined"||r==null||r.length==0){r="#sg-control"}var o=i(r);o.html(q);l(o)}});i(".sg-control-set",n).click(function(r){var q=i(this);var p=q.attr("data-target-id");if(typeof p=="undefined"||p==null||p.length==0){p="#sg-control";m()}var o=i(p);o.wrapInner("<div class='sg-disabled'></div>");o.prepend(i("#sg-wait").html());i.get(q.attr("href"),function(s){o.html(s);l(o)});r.preventDefault()});i("[data-data-dblclick]",n).dblclick(function(){i.get(i(this).attr("data-data-dblclick"),function(r){var q=r.match(b);if(q!=null&&q.length>=2){i("#"+q[2]).remove()}var p=i("#sg-data");p.prepend(r);var o=p.children(":first");l(o);i("html, body").animate({scrollTop:o.offset().top},500)})});i("tr [data-confirm]",n).click(function(p){var o=i(this);if(confirm(o.attr("data-confirm"))){var q=o.closest("tr");q.addClass("sg-disabled");i.get(o.attr("href"),function(r){q.slideUp("fast",function(){q.remove()})})}p.preventDefault()});i(".sg-replace-content",n).on("shown.bs.tab",function(q){var p=i(i(this).attr("href"));var o=i(this).attr("data-url");i.get(o,function(r){p.html(r);l(p)});i(this).removeClass("sg-replace-content");i(this).unbind("shown.bs.tab")});i(".sg-data-close",n).click(function(o){i(this).parent().parent().fadeOut("fast",function(){i(this).remove()})});i("input.sg-fileupload",n).fileinput({showUpload:false});i("input.sg-fileupload-small",n).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});i(".sg-pictogram-modal").on("shown.bs.modal",function(){var r=i(this);var q=r.attr("id");var p=i("#container-"+q,r);var o=i("#filter-"+q,r);o.on("input propertychange paste",function(){k(r,p,q,n,i(this).val())}).onEnter(function(){var t=i(".sg-pictogram-modal-link",p).first();if(t.length>0){var v=t.attr("data-id");var u=t.attr("data-id");var s=i("<div/>").text(t.attr("title")).html();i("#value-"+q,n).val(v);i("#preview-"+q,n).html('<img src="'+urlSegradaPictogramFile+u+'" width="24" height="24" alt="'+s+'" /> '+s);i("#clear-"+q,n).show();r.modal("hide")}});if(o.val()===""){k(r,p,q,n,"")}});i(".sg-pictogram-chooser",n).click(function(o){i("#"+i(this).attr("data-id")).modal("show");o.preventDefault()});i(".sg-pictogram-clearer",n).click(function(p){var o=i(this).attr("data-id");i("#value-"+o,n).val("");i("#preview-"+o,n).html("");i(this).hide();p.preventDefault()});i(".sg-source-ref-modal").on("shown.bs.modal",function(){var q=i(this);var p=q.attr("id");var o=i(".modal-body",q);i.get(q.attr("data-href"),function(r){o.html(r);i("form",o).ajaxForm({beforeSubmit:function(s,t,u){t.wrapInner("<div class='sg-disabled'></div>");t.prepend(i("#sg-wait").html());return true},success:function(t,v,w,s){var u=i(q.attr("data-target"));u.html(t);l(u);q.modal("hide")}})})}).on("hidden.bs.modal",function(){i(".modal-body",i(this)).html(i("#sg-wait").html())});i(".sg-source-ref-editor",n).click(function(p){var o=i("#"+i(this).attr("data-id"));o.attr("data-href",i(this).attr("href"));o.modal("show");p.preventDefault()});i(".sg-taglist-contract",n).each(function(){var o=i("span",i(this));if(o.length>1){o.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');i("span.sg-tag-show",i(this)).click(function(){i(this).remove();o.show()})}});i("select.sg-colorpicker",n).simplepicker({theme:"fontawesome"});i("select.sg-tags",n).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:j.ttAdapter()}});i("input.sg-node-search",n).each(function(){var p=i(this);var o=i("#"+p.attr("data-id"));p.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:a.ttAdapter()}).bind("typeahead:selected",function(r,q){o.val(q.id)}).bind("keyup",function(){if(!this.value){o.val("")}})});i("input.sg-file-search",n).each(function(){var p=i(this);var o=i("#"+p.attr("data-id"));p.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:c.ttAdapter()}).bind("typeahead:selected",function(r,q){o.val(q.id)}).bind("keyup",function(){if(!this.value){o.val("")}})});i("input.sg-source-search",n).each(function(){var p=i(this);var o=i("#"+p.attr("data-id"));p.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:g.ttAdapter()}).bind("typeahead:selected",function(r,q){o.val(q.id)}).bind("keyup",function(){if(!this.value){o.val("")}})});i(".sg-link-external").click(function(q){var o=i(this).attr("href");var p=window.open(o,"_blank");p.focus();q.preventDefault()});i("form.sg-data-form",n).ajaxForm({beforeSubmit:function(o,p,q){i(":input",p).attr("disabled",true);return true},success:function(q,s,t,o){var r=o.attr("data-id");if(typeof r!=="undefined"){r=i("#"+r)}r=r||o;r.replaceWith(q);var p=q.match(b);if(p!=null&&p.length>=2){l(i("#"+p[2]))}}});i("form.sg-simple-form",n).ajaxForm({beforeSubmit:function(o,p,q){i(":input",p).attr("disabled",true);var r=p.attr("data-id");if(typeof r!=="undefined"){r=i("#"+r)}r=r||p;r.html(i("#sg-wait"));return true},success:function(p,r,s,o){var q=o.attr("data-id");if(typeof q!=="undefined"){q=i("#"+q)}q=q||o;q.html(p);i(":input",o).attr("disabled",false)}});i(".sg-periods").each(function(){var o=i(this);var q=o.attr("id");var p=i(".sg-period-form",o);i(".sg-period-add",o).click(function(r){i(this).hide();p.show();r.preventDefault()});i(".sg-period-form-period",o).change(function(r){if(i(this).is(":checked")){i(".sg-period-toggle",o).show()}else{i(".sg-period-toggle",o).hide()}});p.ajaxForm({beforeSubmit:function(r,s,t){o.addClass("disabled");return true},success:function(s,t,u,r){o.replaceWith(s);l(o)}})});i(".sg-geotab",n).on("shown.bs.tab",function(t){var s=i(t.target);if(s.attr("data-created")=="1"){return}s.attr("data-created","1");var u=s.attr("data-locations-id");var p=i(u);var r=i(".sg-map-form",p);var q=i(".sg-geocomplete",r);var o=new google.maps.LatLng(0,0);q.geocomplete({map:u+"-map",details:u+"-form",markerOptions:{draggable:true},mapOptions:{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:1,center:o,scrollwheel:true,draggable:true}}).bind("geocode:result",function(w,v){i("input[type=submit]",r).show()}).bind("geocode:dragged",function(w,v){i("input[name=lat]",r).val(v.lat());i("input[name=lng]",r).val(v.lng())});i(".sg-map-add-marker",p).click(function(v){i(this).hide();r.show();v.preventDefault()});e(u,i(u+"-markers",p),q);i(u+"-map").on("destroyed",function(){if(typeof f[u]!=="undefined"){for(var v=0;v<f[u].length;v++){f[u][v].setMap(null)}delete f[u]}});i(".sg-geocomplete-find",r).click(function(){q.trigger("geocode")}).click();r.ajaxForm({beforeSubmit:function(v,w,x){p.addClass("disabled");return true},success:function(w,x,y,v){p.removeClass("disabled");i(u+"-markers",p).replaceWith(w);e(u,i(u+"-markers",p),q)}})})}var f=[];function e(t,o,n){var s=n.geocomplete("map");if(typeof f[t]!=="undefined"){for(var p=0;p<f[t].length;p++){f[t][p].setMap(null)}delete f[t]}f[t]=[];var r=i(t+"-delete").html();var q=new google.maps.LatLngBounds();i(".sg-location-marker",o).each(function(){var v=new google.maps.LatLng(i(this).attr("data-lat"),i(this).attr("data-lng"));q.extend(v);var w=i(this).attr("data-id");var x=new google.maps.InfoWindow({content:"<p>"+i(this).attr("data-lat")+","+i(this).attr("data-lng")+'</p><p><a href="'+i(this).attr("data-delete")+'" id="'+w+'">'+r+"</a></p>"});var u=new google.maps.Marker({position:v,map:s,icon:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"});google.maps.event.addListener(u,"click",function(){x.open(s,u);var y=i("#"+w);y.unbind("click");y.click(function(z){i.get(i(this).attr("href"),function(A){o.replaceWith(A);e(t,i(t+"-markers"),n)});z.preventDefault()})});f[t][f[t].length]=u});if(f[t].length==0){s.setZoom(1);s.setCenter(new google.maps.LatLng(0,0))}else{s.fitBounds(q)}}function m(){var n=i("#sg-toggle-graph");if(n.hasClass("active")){n.removeClass("active");i(".fa-share-alt-square",n).addClass("fa-share-alt").removeClass("fa-share-alt-square");i("#sg-graph-container").hide();i("#sg-control").show()}}function d(){var n=i("#sg-toggle-graph");if(!n.hasClass("active")){n.addClass("active");i(".fa-share-alt",n).addClass("fa-share-alt-square").removeClass("fa-share-alt");i("#sg-control").hide();i("#sg-graph-container").show()}}i.event.special.destroyed={remove:function(n){if(n.handler){n.handler()}}};i(document).ready(function(){i("#sg-close-all").click(function(n){i(".sg-data").fadeOut("fast",function(){i(this).remove()});n.preventDefault()});i(".sg-locale").click(function(n){i.get(i(this).attr("href"),function(p){var o=i("#sg-base").html();if(p!=""){window.location.href=o}});n.preventDefault()});j.initialize();i("#sg-graph-container").hide();i("#sg-toggle-graph").click(function(n){if(i(this).hasClass("active")){m()}else{d()}n.preventDefault()});l(i("body"))})})(jQuery);