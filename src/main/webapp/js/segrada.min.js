(function(c){var g=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var i=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(t,u){var v=t+u;var s=c(".sg-node-search").filter(":focus");var x=c("#"+s.attr("data-select-id")+" option").filter(":selected");var w=x.attr(s.attr("data-attr"));if(w!=null&&w.length>0){v+="&tags="+encodeURIComponent(w)}return v}}});var l=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaFileSearch+"%QUERY"}});var r=new Bloodhound({datumTokenizer:function(s){return Bloodhound.tokenizers.whitespace(s.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaSourceSearch+"%QUERY"}});var k=(typeof google==="object"&&typeof google.maps==="object")?new google.maps.Geocoder():null;var h=false;var e=new vis.DataSet([]);var p=new vis.DataSet([]);var a=null;c.fn.onEnter=function(s){this.bind("keypress",function(t){if(t.keyCode==13){s.apply(this,[t])}});return this};var j=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function d(x,w,v,s,u){var t=urlSegradaPictogramSearch+encodeURIComponent(u);c.getJSON(t,function(z){var y=[];c.each(z,function(A,B){var C=c("<div/>").text(B.title).html();y.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+B.id+'" data-uid="'+B.uid+'" title="'+C+'"><img src="'+urlSegradaPictogramFile+B.uid+'" width="24" height="24" alt="'+C+'" /></a></div>')});w.html("<div class='row'>"+y.join("")+"</div>");c("a",w).click(function(D){var C=c(this).attr("data-id");var B=c(this).attr("data-uid");var A=c("<div/>").text(c(this).attr("title")).html();c("#value-"+v,s).val(C);c("#preview-"+v,s).html('<img src="'+urlSegradaPictogramFile+B+'" width="24" height="24" alt="'+A+'" /> '+A);c("#clear-"+v,s).show();D.preventDefault();x.modal("hide")})})}function m(s){s=s||c("body");c(".sg-data").addClass("sg-dynamic-data");c(".sg-headbox-right").show();c(".sg-dynamic-hide").hide();c(".sg-data-add",s).click(function(t){c.get(c(this).attr("href"),function(x){var w=x.match(j);if(w!=null&&w.length>=2){c("#"+w[2]).remove()}var v=c("#sg-data");v.prepend(x);var u=v.children(":first");m(u);c("html, body").animate({scrollTop:u.offset().top},500)});t.preventDefault()});c(".sg-control-form",s).ajaxForm({beforeSubmit:function(t,v,w){var x=v.attr("data-target-id");if(typeof x=="undefined"||x==null||x.length==0){x="#sg-control"}var u=c(x);u.wrapInner("<div class='sg-disabled'></div>");u.prepend(c("#sg-wait").html());return true},success:function(v,x,y,u){var w=u.attr("data-target-id");if(typeof w=="undefined"||w==null||w.length==0){w="#sg-control"}var t=c(w);t.html(v);m(t)}});c(".sg-control-set",s).click(function(w){var v=c(this);var u=v.attr("data-target-id");if(typeof u=="undefined"||u==null||u.length==0){u="#sg-control";f()}var t=c(u);t.wrapInner("<div class='sg-disabled'></div>");t.prepend(c("#sg-wait").html());c.get(v.attr("href"),function(x){t.html(x);m(t)});w.preventDefault()});c("[data-data-dblclick]",s).dblclick(function(){c.get(c(this).attr("data-data-dblclick"),function(w){var v=w.match(j);if(v!=null&&v.length>=2){c("#"+v[2]).remove()}var u=c("#sg-data");u.prepend(w);var t=u.children(":first");m(t);c("html, body").animate({scrollTop:t.offset().top},500)})});c("tr [data-confirm]",s).click(function(u){var t=c(this);if(confirm(t.attr("data-confirm"))){var v=t.closest("tr");v.addClass("sg-disabled");c.get(t.attr("href"),function(w){v.slideUp("fast",function(){v.remove()})})}u.preventDefault()});c(".sg-replace-content",s).on("shown.bs.tab",function(v){var u=c(c(this).attr("href"));var t=c(this).attr("data-url");c.get(t,function(w){u.html(w);m(u)});c(this).removeClass("sg-replace-content");c(this).unbind("shown.bs.tab")});c(".sg-data-close",s).click(function(t){c(this).parent().parent().fadeOut("fast",function(){c(this).remove()})});c("input.sg-fileupload",s).fileinput({showUpload:false});c("input.sg-fileupload-small",s).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});c(".sg-pictogram-modal").on("shown.bs.modal",function(){var w=c(this);var v=w.attr("id");var u=c("#container-"+v,w);var t=c("#filter-"+v,w);t.on("input propertychange paste",function(){d(w,u,v,s,c(this).val())}).onEnter(function(){var y=c(".sg-pictogram-modal-link",u).first();if(y.length>0){var A=y.attr("data-id");var z=y.attr("data-id");var x=c("<div/>").text(y.attr("title")).html();c("#value-"+v,s).val(A);c("#preview-"+v,s).html('<img src="'+urlSegradaPictogramFile+z+'" width="24" height="24" alt="'+x+'" /> '+x);c("#clear-"+v,s).show();w.modal("hide")}});if(t.val()===""){d(w,u,v,s,"")}});c(".sg-pictogram-chooser",s).click(function(t){c("#"+c(this).attr("data-id")).modal("show");t.preventDefault()});c(".sg-pictogram-clearer",s).click(function(u){var t=c(this).attr("data-id");c("#value-"+t,s).val("");c("#preview-"+t,s).html("");c(this).hide();u.preventDefault()});c(".sg-source-ref-modal").on("shown.bs.modal",function(){var v=c(this);var u=v.attr("id");var t=c(".modal-body",v);c.get(v.attr("data-href"),function(w){t.html(w);c("form",t).ajaxForm({beforeSubmit:function(x,y,z){y.wrapInner("<div class='sg-disabled'></div>");y.prepend(c("#sg-wait").html());return true},success:function(y,A,B,x){var z=c(v.attr("data-target"));z.html(y);m(z);v.modal("hide")}})})}).on("hidden.bs.modal",function(){c(".modal-body",c(this)).html(c("#sg-wait").html())});c(".sg-source-ref-editor",s).click(function(u){var t=c("#"+c(this).attr("data-id"));t.attr("data-href",c(this).attr("href"));t.modal("show");u.preventDefault()});c(".sg-taglist-contract",s).each(function(){var t=c("span",c(this));if(t.length>1){t.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');c("span.sg-tag-show",c(this)).click(function(){c(this).remove();t.show()})}});c("select.sg-colorpicker",s).simplepicker({theme:"fontawesome"});c("select.sg-tags",s).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:g.ttAdapter()}});c("input.sg-node-search",s).each(function(){var u=c(this);var t=c("#"+u.attr("data-id"));u.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:i.ttAdapter()}).bind("typeahead:selected",function(w,v){t.val(v.id)}).bind("keyup",function(){if(!this.value){t.val("")}})});c("input.sg-file-search",s).each(function(){var u=c(this);var t=c("#"+u.attr("data-id"));u.typeahead({hint:true,highlight:true,minLength:1},{name:"file",displayKey:"title",valueKey:"id",source:l.ttAdapter()}).bind("typeahead:selected",function(w,v){t.val(v.id)}).bind("keyup",function(){if(!this.value){t.val("")}})});c("input.sg-source-search",s).each(function(){var u=c(this);var t=c("#"+u.attr("data-id"));u.typeahead({hint:true,highlight:true,minLength:1},{name:"source",displayKey:"title",valueKey:"id",source:r.ttAdapter()}).bind("typeahead:selected",function(w,v){t.val(v.id)}).bind("keyup",function(){if(!this.value){t.val("")}})});c(".sg-link-external").click(function(v){var t=c(this).attr("href");var u=window.open(t,"_blank");u.focus();v.preventDefault()});c("form.sg-data-form",s).ajaxForm({beforeSubmit:function(t,u,v){c(":input",u).attr("disabled",true);return true},success:function(v,x,y,t){var w=t.attr("data-id");if(typeof w!=="undefined"){w=c("#"+w)}w=w||t;w.replaceWith(v);var u=v.match(j);if(u!=null&&u.length>=2){m(c("#"+u[2]))}}});c("form.sg-simple-form",s).ajaxForm({beforeSubmit:function(t,u,v){c(":input",u).attr("disabled",true);var w=u.attr("data-id");if(typeof w!=="undefined"){w=c("#"+w)}w=w||u;w.html(c("#sg-wait"));return true},success:function(u,w,x,t){var v=t.attr("data-id");if(typeof v!=="undefined"){v=c("#"+v)}v=v||t;v.html(u);c(":input",t).attr("disabled",false)}});c(".sg-periods").each(function(){var t=c(this);var v=t.attr("id");var u=c(".sg-period-form",t);c(".sg-period-add",t).click(function(w){c(this).hide();u.show();w.preventDefault()});c(".sg-period-form-period",t).change(function(w){if(c(this).is(":checked")){c(".sg-period-toggle",t).show()}else{c(".sg-period-toggle",t).hide()}});u.ajaxForm({beforeSubmit:function(w,x,y){t.addClass("disabled");return true},success:function(x,y,z,w){t.replaceWith(x);m(t)}})});c(".sg-geotab",s).on("shown.bs.tab",function(y){var x=c(y.target);if(x.attr("data-created")=="1"){return}x.attr("data-created","1");var z=x.attr("data-locations-id");var u=c(z);var w=c(".sg-map-form",u);var v=c(".sg-geocomplete",w);var t=new google.maps.LatLng(0,0);v.geocomplete({map:z+"-map",details:z+"-form",markerOptions:{draggable:true},mapOptions:{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:1,center:t,scrollwheel:true,draggable:true}}).bind("geocode:result",function(B,A){c("input[type=submit]",w).show()}).bind("geocode:dragged",function(B,A){c("input[name=lat]",w).val(A.lat());c("input[name=lng]",w).val(A.lng())});c(".sg-map-add-marker",u).click(function(A){c(this).hide();w.show();A.preventDefault()});q(z,c(z+"-markers",u),v);c(z+"-map").on("destroyed",function(){if(typeof n[z]!=="undefined"){for(var A=0;A<n[z].length;A++){n[z][A].setMap(null)}delete n[z]}});c(".sg-geocomplete-find",w).click(function(){v.trigger("geocode")}).click();w.ajaxForm({beforeSubmit:function(A,B,C){u.addClass("disabled");return true},success:function(B,C,D,A){u.removeClass("disabled");c(z+"-markers",u).replaceWith(B);q(z,c(z+"-markers",u),v)}})})}var n=[];function q(y,t,s){var x=s.geocomplete("map");if(typeof n[y]!=="undefined"){for(var u=0;u<n[y].length;u++){n[y][u].setMap(null)}delete n[y]}n[y]=[];var w=c(y+"-delete").html();var v=new google.maps.LatLngBounds();c(".sg-location-marker",t).each(function(){var A=new google.maps.LatLng(c(this).attr("data-lat"),c(this).attr("data-lng"));v.extend(A);var B=c(this).attr("data-id");var C=new google.maps.InfoWindow({content:"<p>"+c(this).attr("data-lat")+","+c(this).attr("data-lng")+'</p><p><a href="'+c(this).attr("data-delete")+'" id="'+B+'">'+w+"</a></p>"});var z=new google.maps.Marker({position:A,map:x,icon:"https://maps.google.com/mapfiles/ms/micons/blue-dot.png"});google.maps.event.addListener(z,"click",function(){C.open(x,z);var D=c("#"+B);D.unbind("click");D.click(function(E){c.get(c(this).attr("href"),function(F){t.replaceWith(F);q(y,c(y+"-markers"),s)});E.preventDefault()})});n[y][n[y].length]=z});if(n[y].length==0){x.setZoom(1);x.setCenter(new google.maps.LatLng(0,0))}else{x.fitBounds(v)}}function b(){if(!h){h=true;var s=document.getElementById("sg-graph");var u={nodes:e,edges:p};var t={};a=new vis.Network(s,u,t);if(typeof console!="undefined"){console.log("Graph Network was initialized.")}}}function f(){var s=c("#sg-toggle-graph");if(s.hasClass("active")){s.removeClass("active");c(".fa-share-alt-square",s).addClass("fa-share-alt").removeClass("fa-share-alt-square");c("#sg-graph-container").hide();c("#sg-control").show()}}function o(){var s=c("#sg-toggle-graph");if(!s.hasClass("active")){s.addClass("active");c(".fa-share-alt",s).addClass("fa-share-alt-square").removeClass("fa-share-alt");c("#sg-control").hide();c("#sg-graph-container").show();b()}}c.event.special.destroyed={remove:function(s){if(s.handler){s.handler()}}};c(document).ready(function(){c("#sg-close-all").click(function(s){c(".sg-data").fadeOut("fast",function(){c(this).remove()});s.preventDefault()});c(".sg-locale").click(function(s){c.get(c(this).attr("href"),function(u){var t=c("#sg-base").html();if(u!=""){window.location.href=t}});s.preventDefault()});g.initialize();c("#sg-graph-container").hide();c("#sg-toggle-graph").click(function(s){if(c(this).hasClass("active")){f()}else{o()}s.preventDefault()});m(c("body"))})})(jQuery);