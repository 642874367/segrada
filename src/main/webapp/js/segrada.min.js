(function(d){var b=new Bloodhound({datumTokenizer:function(h){return Bloodhound.tokenizers.whitespace(h.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:urlSegradaTagSearch+"%QUERY"}});var g=new Bloodhound({datumTokenizer:function(h){return Bloodhound.tokenizers.whitespace(h.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:urlSegradaNodeSearch,replace:function(i,j){var k=i+j;var h=d(".sg-node-search").filter(":focus");var m=d("#"+h.attr("data-select-id")+" option").filter(":selected");var l=m.attr(h.attr("data-attr"));if(l!=null&&l.length>0){k+="&tags="+encodeURIComponent(l)}return k}}});d.fn.onEnter=function(h){this.bind("keypress",function(i){if(i.keyCode==13){h.apply(this,[i])}});return this};var a=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function c(m,l,k,h,j){var i=urlSegradaPictogramSearch+encodeURIComponent(j);d.getJSON(i,function(o){var n=[];d.each(o,function(p,q){var r=d("<div/>").text(q.title).html();n.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+q.id+'" data-uid="'+q.uid+'" title="'+r+'"><img src="'+urlSegradaPictogramFile+q.uid+'" width="24" height="24" alt="'+r+'" /></a></div>')});l.html("<div class='row'>"+n.join("")+"</div>");d("a",l).click(function(s){var r=d(this).attr("data-id");var q=d(this).attr("data-uid");var p=d("<div/>").text(d(this).attr("title")).html();d("#value-"+k,h).val(r);d("#preview-"+k,h).html('<img src="'+urlSegradaPictogramFile+q+'" width="24" height="24" alt="'+p+'" /> '+p);d("#clear-"+k,h).show();s.preventDefault();m.modal("hide")})})}function e(h){h=h||d("body");d(".sg-data").addClass("sg-dynamic-data");d(".sg-headbox-right").show();d(".sg-dynamic-hide").hide();d(".sg-data-add",h).click(function(i){d.get(d(this).attr("href"),function(m){var l=m.match(a);if(l!=null&&l.length>=2){d("#"+l[2]).remove()}var k=d("#sg-data");k.prepend(m);var j=k.children(":first");e(j)});i.preventDefault()});d(".sg-control-form",h).ajaxForm({beforeSubmit:function(i,k,l){var m=k.attr("data-target-id");if(typeof m=="undefined"||m==null||m.length==0){m="#sg-control"}var j=d(m);j.wrapInner("<div class='sg-disabled'></div>");j.prepend(d("#sg-wait").html());return true},success:function(k,m,n,j){var l=j.attr("data-target-id");if(typeof l=="undefined"||l==null||l.length==0){l="#sg-control"}var i=d(l);i.html(k);e(i)}});d(".sg-control-set",h).click(function(l){var k=d(this);var j=k.attr("data-target-id");if(typeof j=="undefined"||j==null||j.length==0){j="#sg-control"}var i=d(j);i.wrapInner("<div class='sg-disabled'></div>");i.prepend(d("#sg-wait").html());d.get(k.attr("href"),function(m){i.html(m);e(i)});l.preventDefault()});d("[data-data-dblclick]",h).dblclick(function(){d.get(d(this).attr("data-data-dblclick"),function(l){var k=l.match(a);if(k!=null&&k.length>=2){d("#"+k[2]).remove()}var j=d("#sg-data");j.prepend(l);var i=j.children(":first");e(i)})});d("tr [data-confirm]",h).click(function(j){var i=d(this);if(confirm(i.attr("data-confirm"))){var k=i.closest("tr");k.addClass("sg-disabled");d.get(i.attr("href"),function(l){k.slideUp("fast",function(){k.remove()})})}j.preventDefault()});d(".sg-replace-content",h).on("shown.bs.tab",function(k){var j=d(d(this).attr("href"));var i=d(this).attr("data-url");d.get(i,function(l){j.html(l);e(j)});d(this).removeClass("sg-replace-content");d(this).unbind("shown.bs.tab")});d(".sg-data-close",h).click(function(i){d(this).parent().parent().fadeOut("fast",function(){d(this).remove()})});d("input.sg-fileupload",h).fileinput({showUpload:false});d("input.sg-fileupload-small",h).fileinput({showUpload:false,previewSettings:{image:{width:"auto",height:"24px"}}});d(".sg-pictogram-modal").on("shown.bs.modal",function(){var l=d(this);var k=l.attr("id");var j=d("#container-"+k,l);var i=d("#filter-"+k,l);i.on("input propertychange paste",function(){c(l,j,k,h,d(this).val())}).onEnter(function(){var n=d(".sg-pictogram-modal-link",j).first();if(n.length>0){var p=n.attr("data-id");var o=n.attr("data-id");var m=d("<div/>").text(n.attr("title")).html();d("#value-"+k,h).val(p);d("#preview-"+k,h).html('<img src="'+urlSegradaPictogramFile+o+'" width="24" height="24" alt="'+m+'" /> '+m);d("#clear-"+k,h).show();l.modal("hide")}});if(i.val()===""){c(l,j,k,h,"")}});d(".sg-pictogram-chooser",h).click(function(i){d("#"+d(this).attr("data-id")).modal("show");i.preventDefault()});d(".sg-pictogram-clearer",h).click(function(j){var i=d(this).attr("data-id");d("#value-"+i,h).val("");d("#preview-"+i,h).html("");d(this).hide();j.preventDefault()});d(".sg-taglist-contract",h).each(function(){var i=d("span",d(this));if(i.length>1){i.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>');d("span.sg-tag-show",d(this)).click(function(){d(this).remove();i.show()})}});d("select.sg-colorpicker",h).simplepicker({theme:"fontawesome"});d("select.sg-tags",h).tagsinput({trimValue:true,confirmKeys:[13],typeaheadjs:{name:"tags",displayKey:"title",valueKey:"title",source:b.ttAdapter()}});d("input.sg-node-search",h).each(function(){var j=d(this);var i=d("#"+j.attr("data-id"));j.typeahead({hint:true,highlight:true,minLength:1},{name:"node",displayKey:"title",valueKey:"id",source:g.ttAdapter()}).bind("typeahead:selected",function(l,k){i.val(k.id)}).bind("keyup",function(){if(!this.value){i.val("")}})});d("form.sg-data-form",h).ajaxForm({beforeSubmit:function(i,j,k){d(":input",j).attr("disabled",true);return true},success:function(k,m,n,i){var l=i.attr("data-id");if(typeof l!=="undefined"){l=d("#"+l)}l=l||i;l.replaceWith(k);var j=k.match(a);if(j!=null&&j.length>=2){e(d("#"+j[2]))}}});d(".sg-geotab",h).on("shown.bs.tab",function(m){var l=d(m.target);var n=l.attr("data-map-id");var k=new ol.Map({target:n,layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"})})],view:new ol.View({center:ol.proj.fromLonLat([0,0]),zoom:1,maxZoom:10}),controls:ol.control.defaults({attributionOptions:{collapsible:false}})});var j=new ol.source.Vector({features:[]});var i=new ol.layer.Vector({source:j});k.addLayer(i);d("#"+n+"-content div").each(function(){var p=parseFloat(d(this).attr("data-lng"));var q=parseFloat(d(this).attr("data-lat"));var o=f(ol.proj.transform([p,q],"EPSG:4326","EPSG:3857"),mapIconStyle);j.addFeature(o)})})}d(document).ready(function(){d("#sg-close-all").click(function(h){d(".sg-data").fadeOut("fast",function(){d(this).remove()});h.preventDefault()});b.initialize();e(d("body"))});function f(h,i){var j=new ol.Feature({geometry:new ol.geom.Point(h)});j.setStyle(i);return j}mapIconStyle=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"/img/marker-icon.png"}))})})(jQuery);